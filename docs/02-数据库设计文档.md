# å…¨å›½åŒ»é™¢å®˜ç½‘æ‰«æä¸æ‹›æŠ•æ ‡ç›‘æ§ç³»ç»Ÿ - æ•°æ®åº“è®¾è®¡æ–‡æ¡£

**ä½œè€…ï¼š** MiniMax Agent  
**ç‰ˆæœ¬ï¼š** v1.0  
**æ—¥æœŸï¼š** 2025-11-18  
**æ•°æ®åº“ç±»å‹ï¼š** SQLite (å¼€å‘) / PostgreSQL (ç”Ÿäº§)

---

## ğŸ“Š ä¸€ã€æ•°æ®åº“æ•´ä½“è®¾è®¡

### 1.1 è®¾è®¡åŸåˆ™
- **è§„èŒƒåŒ–**ï¼šéµå¾ªç¬¬ä¸‰èŒƒå¼ï¼Œé¿å…æ•°æ®å†—ä½™
- **æ€§èƒ½ä¼˜å…ˆ**ï¼šé’ˆå¯¹æŸ¥è¯¢æ¨¡å¼è®¾è®¡åˆç†çš„ç´¢å¼•
- **æ‰©å±•æ€§å¥½**ï¼šæ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•å’Œæ•°æ®è¿ç§»
- **æ•°æ®å®Œæ•´æ€§**ï¼šé€šè¿‡çº¦æŸç¡®ä¿æ•°æ®è´¨é‡
- **å®¡è®¡è¿½è¸ª**ï¼šè®°å½•å…³é”®æ“ä½œå†å²

### 1.2 æ ¸å¿ƒå®ä½“å…³ç³»
```
å›½å®¶ (Country)
â”œâ”€â”€ çœ/è‡ªæ²»åŒº/ç›´è¾–å¸‚ (Province)
â”‚   â”œâ”€â”€ åœ°çº§å¸‚ (City)  
â”‚   â”‚   â””â”€â”€ åŒºå¿ (County)
â”‚   â”‚       â””â”€â”€ åŒ»é™¢ (Hospital)
â”‚   â”‚           â””â”€â”€ æ‹›æŠ•æ ‡è®°å½• (TenderRecord)
â”‚   â””â”€â”€ åŒ»é™¢ (Hospital)
â”‚       â””â”€â”€ æ‹›æŠ•æ ‡è®°å½• (TenderRecord)
â”œâ”€â”€ åŒ»é™¢ (Hospital)
â”‚   â””â”€â”€ æ‹›æŠ•æ ‡è®°å½• (TenderRecord)
â””â”€â”€ æ‹›æŠ•æ ‡è®°å½• (TenderRecord)
```

### 1.3 æ•°æ®è¡¨æ¦‚è§ˆ
| è¡¨å | è¯´æ˜ | è®°å½•æ•°é¢„ä¼° | å¢é•¿æ¨¡å¼ |
|------|------|-----------|----------|
| regions | è¡Œæ”¿åŒºåˆ’æ•°æ® | ~4000æ¡ | é™æ€æ•°æ® |
| hospitals | åŒ»é™¢ä¿¡æ¯ | ~10ä¸‡æ¡ | çº¿æ€§å¢é•¿ |
| tender_records | æ‹›æŠ•æ ‡è®°å½• | ~100ä¸‡æ¡ | å¿«é€Ÿå¢é•¿ |
| hospital_alias | åŒ»é™¢åˆ«å | ~5ä¸‡æ¡ | ä¸åŒ»é™¢åŒæ­¥å¢é•¿ |
| scan_history | æ‰«æå†å² | ~10ä¸‡æ¡ | çº¿æ€§å¢é•¿ |
| settings | ç³»ç»Ÿé…ç½® | ~50æ¡ | å¢é•¿ç¼“æ…¢ |
| crawler_logs | çˆ¬è™«æ—¥å¿— | ~50ä¸‡æ¡ | å¿«é€Ÿå¢é•¿ |
| tender_raw_html | åŸå§‹HTML | ~20ä¸‡æ¡ | ä¸æ‹›æŠ•æ ‡åŒæ­¥å¢é•¿ |

---

## ğŸ—ƒï¸ äºŒã€è¯¦ç»†è¡¨ç»“æ„è®¾è®¡

### 2.1 è¡Œæ”¿åŒºåˆ’è¡¨ (regions)

**è¡¨åï¼š** `regions`  
**ç”¨é€”ï¼š** å­˜å‚¨å…¨å›½è¡Œæ”¿åŒºåˆ’å±‚çº§æ•°æ®

```sql
CREATE TABLE regions (
    -- ä¸»é”®å­—æ®µ
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    
    -- åŸºæœ¬ä¿¡æ¯
    name VARCHAR(100) NOT NULL COMMENT 'åœ°åŒºåç§°',
    code VARCHAR(20) UNIQUE NOT NULL COMMENT 'è¡Œæ”¿åŒºåˆ’ä»£ç ',
    level ENUM('country', 'province', 'city', 'county') NOT NULL COMMENT 'å±‚çº§',
    
    -- å±‚çº§å…³ç³»
    parent_id INTEGER COMMENT 'çˆ¶çº§åœ°åŒºID',
    sort_order INTEGER DEFAULT 0 COMMENT 'æ’åºé¡ºåº',
    
    -- åœ°ç†ä¿¡æ¯
    longitude DECIMAL(10, 7) COMMENT 'ç»åº¦',
    latitude DECIMAL(10, 7) COMMENT 'çº¬åº¦',
    area_code VARCHAR(10) COMMENT 'ç”µè¯åŒºå·',
    postal_code VARCHAR(10) COMMENT 'é‚®æ”¿ç¼–ç ',
    
    -- ç»Ÿè®¡ä¿¡æ¯
    hospital_count INTEGER DEFAULT 0 COMMENT 'åŒ»é™¢æ•°é‡',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (parent_id) REFERENCES regions(id) ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¡Œæ”¿åŒºåˆ’è¡¨';
```

**å­—æ®µè¯´æ˜ï¼š**
- `code`: è¡Œæ”¿åŒºåˆ’ç»Ÿä¸€ä»£ç ï¼Œå¦‚"110000"(åŒ—äº¬å¸‚)
- `level`: ä¸¥æ ¼æ§åˆ¶å±‚çº§ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
- `parent_id`: è‡ªå¼•ç”¨å¤–é”®ï¼Œå½¢æˆæ ‘å½¢ç»“æ„

### 2.2 åŒ»é™¢ä¿¡æ¯è¡¨ (hospitals)

**è¡¨åï¼š** `hospitals`  
**ç”¨é€”ï¼š** å­˜å‚¨åŒ»é™¢åŸºæœ¬ä¿¡æ¯å’Œå®˜ç½‘æ•°æ®

```sql
CREATE TABLE hospitals (
    -- ä¸»é”®å­—æ®µ
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    
    -- åŸºæœ¬ä¿¡æ¯
    name VARCHAR(200) NOT NULL COMMENT 'åŒ»é™¢åç§°',
    official_name VARCHAR(200) COMMENT 'åŒ»é™¢å…¨ç§°',
    short_name VARCHAR(100) COMMENT 'åŒ»é™¢ç®€ç§°',
    english_name VARCHAR(200) COMMENT 'è‹±æ–‡åç§°',
    
    -- ç½‘å€ä¿¡æ¯
    website_url VARCHAR(500) COMMENT 'å®˜ç½‘åœ°å€',
    domain_name VARCHAR(100) COMMENT 'åŸŸå',
    is_https BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦ä½¿ç”¨HTTPS',
    
    -- åˆ†ç±»ä¿¡æ¯
    hospital_type ENUM('public', 'private', 'community', 'specialized', 'traditional') 
        DEFAULT 'public' COMMENT 'åŒ»é™¢ç±»å‹',
    hospital_level ENUM('unknown', 'level1', 'level2', 'level3', 'level3a') 
        DEFAULT 'unknown' COMMENT 'åŒ»é™¢ç­‰çº§',
    ownership ENUM('government', 'private', 'collective', 'foreign', 'mixed') 
        DEFAULT 'government' COMMENT 'æ‰€æœ‰åˆ¶æ€§è´¨',
    
    -- åœ°ç†ä¿¡æ¯
    region_id INTEGER NOT NULL COMMENT 'æ‰€å±è¡Œæ”¿åŒº',
    address TEXT COMMENT 'åŒ»é™¢åœ°å€',
    longitude DECIMAL(10, 7) COMMENT 'ç»åº¦',
    latitude DECIMAL(10, 7) COMMENT 'çº¬åº¦',
    
    -- è”ç³»ä¿¡æ¯
    phone VARCHAR(50) COMMENT 'è”ç³»ç”µè¯',
    email VARCHAR(100) COMMENT 'ç”µå­é‚®ç®±',
    fax VARCHAR(50) COMMENT 'ä¼ çœŸ',
    
    -- çŠ¶æ€ä¿¡æ¯
    status ENUM('active', 'inactive', 'closed', 'relocated') DEFAULT 'active' COMMENT 'åŒ»é™¢çŠ¶æ€',
    verified BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·²éªŒè¯',
    verification_date TIMESTAMP COMMENT 'éªŒè¯æ—¶é—´',
    last_scan_time TIMESTAMP COMMENT 'æœ€åæ‰«ææ—¶é—´',
    last_success_scan_time TIMESTAMP COMMENT 'æœ€åæˆåŠŸæ‰«ææ—¶é—´',
    
    -- ç»Ÿè®¡ä¿¡æ¯
    tender_count INTEGER DEFAULT 0 COMMENT 'æ‹›æŠ•æ ‡è®°å½•æ•°',
    scan_success_count INTEGER DEFAULT 0 COMMENT 'æ‰«ææˆåŠŸæ¬¡æ•°',
    scan_failed_count INTEGER DEFAULT 0 COMMENT 'æ‰«æå¤±è´¥æ¬¡æ•°',
    
    -- æ‰©å±•ä¿¡æ¯
    description TEXT COMMENT 'åŒ»é™¢æè¿°',
    specialties TEXT COMMENT 'ç‰¹è‰²ç§‘å®¤',
    bed_count INTEGER COMMENT 'åºŠä½æ•°',
    staff_count INTEGER COMMENT 'å‘˜å·¥æ•°é‡',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (region_id) REFERENCES regions(id) ON DELETE RESTRICT,
    
    -- å”¯ä¸€çº¦æŸ
    UNIQUE(website_url),
    INDEX idx_hospitals_region_verified (region_id, verified),
    INDEX idx_hospitals_type (hospital_type),
    INDEX idx_hospitals_status (status),
    INDEX idx_hospitals_scan_time (last_scan_time),
    FULLTEXT idx_hospitals_search (name, official_name, address)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŒ»é™¢ä¿¡æ¯è¡¨';
```

### 2.3 åŒ»é™¢åˆ«åè¡¨ (hospital_alias)

**è¡¨åï¼š** `hospital_alias`  
**ç”¨é€”ï¼š** å­˜å‚¨åŒ»é™¢åˆ«åï¼Œæ–¹ä¾¿æœç´¢å’ŒåŒ¹é…

```sql
CREATE TABLE hospital_alias (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    hospital_id INTEGER NOT NULL COMMENT 'åŒ»é™¢ID',
    alias_name VARCHAR(200) NOT NULL COMMENT 'åˆ«å',
    alias_type ENUM('abbreviation', 'former_name', 'nickname', 'nickname', 'common_name') 
        DEFAULT 'abbreviation' COMMENT 'åˆ«åç±»å‹',
    is_official BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å®˜æ–¹åˆ«å',
    confidence_score DECIMAL(3, 2) DEFAULT 0.00 COMMENT 'å¯ä¿¡åº¦åˆ†æ•°',
    source VARCHAR(100) COMMENT 'æ¥æº',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (hospital_id) REFERENCES hospitals(id) ON DELETE CASCADE,
    UNIQUE(hospital_id, alias_name),
    INDEX idx_alias_name (alias_name),
    INDEX idx_alias_hospital (hospital_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŒ»é™¢åˆ«åè¡¨';
```

### 2.4 æ‹›æŠ•æ ‡è®°å½•è¡¨ (tender_records)

**è¡¨åï¼š** `tender_records`  
**ç”¨é€”ï¼š** å­˜å‚¨åŒ»é™¢æ‹›æŠ•æ ‡ä¿¡æ¯

```sql
CREATE TABLE tender_records (
    -- ä¸»é”®å­—æ®µ
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    
    -- åŸºæœ¬ä¿¡æ¯
    hospital_id INTEGER NOT NULL COMMENT 'åŒ»é™¢ID',
    title VARCHAR(500) NOT NULL COMMENT 'æ‹›æ ‡æ ‡é¢˜',
    content TEXT COMMENT 'æ‹›æ ‡å†…å®¹æ‘˜è¦',
    
    -- è¯¦ç»†ä¿¡æ¯
    tender_type ENUM('procurement', 'construction', 'service', 'medical', 'equipment', 'other') 
        DEFAULT 'other' COMMENT 'æ‹›æ ‡ç±»å‹',
    tender_category ENUM('construction', 'medical_equipment', 'drugs', 'service', 'it', 'other') 
        DEFAULT 'other' COMMENT 'æ‹›æ ‡åˆ†ç±»',
    budget_amount DECIMAL(15, 2) COMMENT 'é¢„ç®—é‡‘é¢',
    budget_currency ENUM('CNY', 'USD', 'EUR', 'other') DEFAULT 'CNY' COMMENT 'é¢„ç®—å¸ç§',
    
    -- æ—¶é—´ä¿¡æ¯
    publish_date DATE COMMENT 'å‘å¸ƒæ—¥æœŸ',
    deadline_date DATE COMMENT 'æˆªæ­¢æ—¥æœŸ',
    start_date DATE COMMENT 'å¼€å§‹æ—¥æœŸ',
    end_date DATE COMMENT 'ç»“æŸæ—¥æœŸ',
    
    -- ç½‘å€ä¿¡æ¯
    source_url VARCHAR(500) COMMENT 'åŸå§‹é“¾æ¥',
    detail_url VARCHAR(500) COMMENT 'è¯¦æƒ…é“¾æ¥',
    
    -- å†…å®¹æ ‡è¯†
    content_hash VARCHAR(64) UNIQUE NOT NULL COMMENT 'å†…å®¹å“ˆå¸Œ',
    html_hash VARCHAR(64) COMMENT 'HTMLå†…å®¹å“ˆå¸Œ',
    
    -- çŠ¶æ€ä¿¡æ¯
    status ENUM('published', 'in_progress', 'closed', 'cancelled', 'awarded') 
        DEFAULT 'published' COMMENT 'æ‹›æ ‡çŠ¶æ€',
    is_important BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦é‡è¦',
    importance_reason TEXT COMMENT 'é‡è¦åŸå› ',
    
    -- æ•°æ®æ¥æº
    source_page_title VARCHAR(500) COMMENT 'æ¥æºé¡µé¢æ ‡é¢˜',
    source_section VARCHAR(100) COMMENT 'æ¥æºæ ç›®',
    crawl_method ENUM('auto', 'manual') DEFAULT 'auto' COMMENT 'é‡‡é›†æ–¹å¼',
    verified BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·²éªŒè¯',
    
    -- ç»Ÿè®¡åˆ†æ
    view_count INTEGER DEFAULT 0 COMMENT 'æŸ¥çœ‹æ¬¡æ•°',
    download_count INTEGER DEFAULT 0 COMMENT 'ä¸‹è½½æ¬¡æ•°',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (hospital_id) REFERENCES hospitals(id) ON DELETE CASCADE,
    
    -- ç´¢å¼•è®¾è®¡
    INDEX idx_tenders_hospital_date (hospital_id, publish_date),
    INDEX idx_tenders_date (publish_date),
    INDEX idx_tenders_type (tender_type),
    INDEX idx_tenders_status (status),
    INDEX idx_tenders_hash (content_hash),
    INDEX idx_tenders_important (is_important, publish_date),
    FULLTEXT idx_tenders_search (title, content)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‹›æŠ•æ ‡è®°å½•è¡¨';
```

### 2.5 æ‰«æå†å²è¡¨ (scan_history)

**è¡¨åï¼š** `scan_history`  
**ç”¨é€”ï¼š** è®°å½•æ¯æ¬¡æ‰«æä»»åŠ¡çš„æ‰§è¡Œå†å²

```sql
CREATE TABLE scan_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    
    -- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯
    task_id VARCHAR(50) UNIQUE NOT NULL COMMENT 'ä»»åŠ¡ID',
    task_name VARCHAR(200) NOT NULL COMMENT 'ä»»åŠ¡åç§°',
    scan_type ENUM('hospital_discovery', 'hospital_scan', 'tender_monitor', 'full_scan') 
        NOT NULL COMMENT 'æ‰«æç±»å‹',
    
    -- ç›®æ ‡ä¿¡æ¯
    target_type ENUM('region', 'hospital') NOT NULL COMMENT 'ç›®æ ‡ç±»å‹',
    target_id INTEGER COMMENT 'ç›®æ ‡ID',
    target_description TEXT COMMENT 'ç›®æ ‡æè¿°',
    
    -- æ‰§è¡Œä¿¡æ¯
    start_time TIMESTAMP NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
    end_time TIMESTAMP COMMENT 'ç»“æŸæ—¶é—´',
    duration_seconds INTEGER COMMENT 'æ‰§è¡Œæ—¶é•¿(ç§’)',
    status ENUM('pending', 'running', 'success', 'failed', 'partial', 'cancelled') 
        DEFAULT 'pending' COMMENT 'æ‰§è¡ŒçŠ¶æ€',
    
    -- ç»Ÿè®¡ä¿¡æ¯
    total_count INTEGER DEFAULT 0 COMMENT 'æ€»æ•°é‡',
    success_count INTEGER DEFAULT 0 COMMENT 'æˆåŠŸæ•°é‡',
    failed_count INTEGER DEFAULT 0 COMMENT 'å¤±è´¥æ•°é‡',
    new_records INTEGER DEFAULT 0 COMMENT 'æ–°è®°å½•æ•°',
    
    -- ç»“æœä¿¡æ¯
    records_found INTEGER DEFAULT 0 COMMENT 'å‘ç°çš„è®°å½•æ•°',
    hospitals_discovered INTEGER DEFAULT 0 COMMENT 'å‘ç°çš„æ–°åŒ»é™¢æ•°',
    tenders_found INTEGER DEFAULT 0 COMMENT 'å‘ç°çš„æ‹›æŠ•æ ‡æ•°',
    
    -- é”™è¯¯ä¿¡æ¯
    error_code VARCHAR(20) COMMENT 'é”™è¯¯ä»£ç ',
    error_message TEXT COMMENT 'é”™è¯¯ä¿¡æ¯',
    error_details TEXT COMMENT 'é”™è¯¯è¯¦æƒ…',
    
    -- ç³»ç»Ÿä¿¡æ¯
    system_version VARCHAR(20) COMMENT 'ç³»ç»Ÿç‰ˆæœ¬',
    crawler_config JSON COMMENT 'çˆ¬è™«é…ç½®',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‰«æå†å²è¡¨';

-- ç´¢å¼•
CREATE INDEX idx_scan_history_time (start_time);
CREATE INDEX idx_scan_history_type (scan_type);
CREATE INDEX idx_scan_history_status (status);
CREATE INDEX idx_scan_history_target (target_type, target_id);
```

### 2.6 ç³»ç»Ÿé…ç½®è¡¨ (settings)

**è¡¨åï¼š** `settings`  
**ç”¨é€”ï¼š** å­˜å‚¨ç³»ç»Ÿé…ç½®å‚æ•°

```sql
CREATE TABLE settings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    key_name VARCHAR(100) UNIQUE NOT NULL COMMENT 'é…ç½®é”®',
    key_value TEXT COMMENT 'é…ç½®å€¼',
    key_type ENUM('string', 'integer', 'float', 'boolean', 'json') 
        DEFAULT 'string' COMMENT 'å€¼ç±»å‹',
    description TEXT COMMENT 'é…ç½®è¯´æ˜',
    is_system BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦ç³»ç»Ÿé…ç½®',
    is_editable BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç¼–è¾‘',
    category VARCHAR(50) DEFAULT 'general' COMMENT 'é…ç½®åˆ†ç±»',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç³»ç»Ÿé…ç½®è¡¨';

-- é»˜è®¤é…ç½®é¡¹
INSERT INTO settings (key_name, key_value, key_type, description, category) VALUES
('crawler_interval_hours', '6', 'integer', 'çˆ¬è™«æ‰«æé—´éš”(å°æ—¶)', 'crawler'),
('crawler_max_concurrent', '3', 'integer', 'æœ€å¤§å¹¶å‘æ•°', 'crawler'),
('crawler_request_delay_min', '2', 'integer', 'è¯·æ±‚å»¶è¿Ÿæœ€å°å€¼(ç§’)', 'crawler'),
('crawler_request_delay_max', '5', 'integer', 'è¯·æ±‚å»¶è¿Ÿæœ€å¤§å€¼(ç§’)', 'crawler'),
('crawler_user_agent', 'HospitalTenderMonitor/1.0 (Research Purpose Only)', 'string', 'ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²', 'crawler'),
('crawler_respect_robots', 'true', 'boolean', 'æ˜¯å¦éµå®ˆrobots.txt', 'crawler'),
('database_auto_backup', 'true', 'boolean', 'æ˜¯å¦è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“', 'database'),
('export_excel_date_format', 'YYYY-MM-DD', 'string', 'Excelå¯¼å‡ºæ—¥æœŸæ ¼å¼', 'export'),
('log_level', 'INFO', 'string', 'æ—¥å¿—çº§åˆ«', 'system'),
('log_max_files', '10', 'integer', 'æœ€å¤§æ—¥å¿—æ–‡ä»¶æ•°', 'system');
```

### 2.7 çˆ¬è™«æ—¥å¿—è¡¨ (crawler_logs)

**è¡¨åï¼š** `crawler_logs`  
**ç”¨é€”ï¼š** è®°å½•çˆ¬è™«è¯¦ç»†æ‰§è¡Œæ—¥å¿—

```sql
CREATE TABLE crawler_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    
    -- å…³è”ä¿¡æ¯
    task_id VARCHAR(50) COMMENT 'å…³è”ä»»åŠ¡ID',
    hospital_id INTEGER COMMENT 'å…³è”åŒ»é™¢ID',
    
    -- æ—¥å¿—ä¿¡æ¯
    log_level ENUM('DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL') 
        DEFAULT 'INFO' COMMENT 'æ—¥å¿—çº§åˆ«',
    category ENUM('crawler', 'parser', 'network', 'database', 'system') 
        DEFAULT 'crawler' COMMENT 'æ—¥å¿—åˆ†ç±»',
    message TEXT NOT NULL COMMENT 'æ—¥å¿—ä¿¡æ¯',
    
    -- ä¸Šä¸‹æ–‡ä¿¡æ¯
    url VARCHAR(500) COMMENT 'ç›¸å…³URL',
    user_agent VARCHAR(200) COMMENT 'ä½¿ç”¨çš„User-Agent',
    response_code INTEGER COMMENT 'HTTPå“åº”ç ',
    response_time_ms INTEGER COMMENT 'å“åº”æ—¶é—´(æ¯«ç§’)',
    
    -- é”™è¯¯ä¿¡æ¯
    error_code VARCHAR(20) COMMENT 'é”™è¯¯ä»£ç ',
    stack_trace TEXT COMMENT 'é”™è¯¯å †æ ˆ',
    
    -- ç³»ç»Ÿä¿¡æ¯
    ip_address VARCHAR(45) COMMENT 'IPåœ°å€',
    process_id INTEGER COMMENT 'è¿›ç¨‹ID',
    thread_id INTEGER COMMENT 'çº¿ç¨‹ID',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_logs_time (created_at),
    INDEX idx_logs_level (log_level),
    INDEX idx_logs_category (category),
    INDEX idx_logs_hospital (hospital_id),
    INDEX idx_logs_task (task_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='çˆ¬è™«æ—¥å¿—è¡¨';
```

### 2.8 åŸå§‹HTMLå­˜å‚¨è¡¨ (tender_raw_html)

**è¡¨åï¼š** `tender_raw_html`  
**ç”¨é€”ï¼š** å­˜å‚¨æ‹›æŠ•æ ‡é¡µé¢çš„åŸå§‹HTMLå†…å®¹

```sql
CREATE TABLE tender_raw_html (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    tender_record_id INTEGER COMMENT 'å…³è”æ‹›æŠ•æ ‡è®°å½•ID',
    hospital_id INTEGER NOT NULL COMMENT 'åŒ»é™¢ID',
    
    -- HTMLå†…å®¹
    html_content LONGTEXT COMMENT 'HTMLå†…å®¹',
    html_hash VARCHAR(64) UNIQUE NOT NULL COMMENT 'HTMLå“ˆå¸Œ',
    
    -- æ¥æºä¿¡æ¯
    source_url VARCHAR(500) NOT NULL COMMENT 'æ¥æºURL',
    section_name VARCHAR(100) COMMENT 'æ ç›®åç§°',
    page_title VARCHAR(500) COMMENT 'é¡µé¢æ ‡é¢˜',
    
    -- å…ƒä¿¡æ¯
    content_type VARCHAR(50) DEFAULT 'text/html' COMMENT 'å†…å®¹ç±»å‹',
    encoding VARCHAR(20) DEFAULT 'utf-8' COMMENT 'ç¼–ç ',
    content_length INTEGER COMMENT 'å†…å®¹é•¿åº¦',
    
    -- çŠ¶æ€ä¿¡æ¯
    parse_status ENUM('raw', 'parsed', 'failed') DEFAULT 'raw' COMMENT 'è§£æçŠ¶æ€',
    parse_error TEXT COMMENT 'è§£æé”™è¯¯ä¿¡æ¯',
    parse_time TIMESTAMP COMMENT 'è§£ææ—¶é—´',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP COMMENT 'è¿‡æœŸæ—¶é—´',
    
    FOREIGN KEY (tender_record_id) REFERENCES tender_records(id) ON DELETE CASCADE,
    FOREIGN KEY (hospital_id) REFERENCES hospitals(id) ON DELETE CASCADE,
    
    INDEX idx_html_hospital_time (hospital_id, created_at),
    INDEX idx_html_hash (html_hash),
    INDEX idx_html_expires (expires_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŸå§‹HTMLå­˜å‚¨è¡¨';
```

---

## ğŸ“ˆ ä¸‰ã€ç´¢å¼•è®¾è®¡

### 3.1 æ ¸å¿ƒæ€§èƒ½ç´¢å¼•
```sql
-- 1. åŒ»é™¢æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_hospitals_region_active ON hospitals(region_id, status) 
    WHERE status = 'active';
CREATE INDEX idx_hospitals_type_verified ON hospitals(hospital_type, verified, id);
CREATE INDEX idx_hospitals_scan_status ON hospitals(verified, last_scan_time);

-- 2. æ‹›æŠ•æ ‡æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_tenders_date_hospital ON tender_records(publish_date DESC, hospital_id);
CREATE INDEX idx_tenders_type_date ON tender_records(tender_type, publish_date DESC);
CREATE INDEX idx_tenders_important_date ON tender_records(is_important, publish_date DESC);

-- 3. å¤åˆç´¢å¼•
CREATE INDEX idx_scan_performance ON scan_history(start_time DESC, scan_type, status);
CREATE INDEX idx_logs_performance ON crawler_logs(created_at DESC, log_level, category);

-- 4. å…¨æ–‡æœç´¢ç´¢å¼•
-- æ³¨æ„ï¼šSQLiteä½¿ç”¨FTSï¼ŒMySQL/MariaDBä½¿ç”¨FULLTEXT
CREATE VIRTUAL TABLE hospitals_fts USING fts5(
    name, official_name, short_name, english_name, 
    address, specialties, content=hospitals, content_rowid=id
);
```

### 3.2 ç´¢å¼•ä½¿ç”¨è¯´æ˜
| æŸ¥è¯¢åœºæ™¯ | å»ºè®®ä½¿ç”¨ç´¢å¼• | é¢„æœŸæ•ˆæœ |
|----------|-------------|----------|
| æŒ‰åœ°åŒºæŸ¥è¯¢åŒ»é™¢ | `idx_hospitals_region_active` | O(log n) |
| æŸ¥è¯¢æœªéªŒè¯åŒ»é™¢ | `idx_hospitals_type_verified` | O(log n) |
| æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢æ‹›æŠ•æ ‡ | `idx_tenders_date_hospital` | O(log n) |
| å…¨æ–‡æœç´¢åŒ»é™¢åç§° | `hospitals_fts` | O(log n) |

---

## ğŸ”— å››ã€å¤–é”®å…³ç³»å›¾

### 4.1 ERå…³ç³»å›¾
```mermaid
erDiagram
    REGIONS {
        integer id PK
        varchar name
        varchar code
        enum level
        integer parent_id FK
        datetime created_at
    }
    
    HOSPITALS {
        integer id PK
        varchar name
        varchar website_url
        enum hospital_type
        integer region_id FK
        enum status
        boolean verified
        datetime last_scan_time
        datetime created_at
    }
    
    HOSPITAL_ALIAS {
        integer id PK
        integer hospital_id FK
        varchar alias_name
        enum alias_type
        boolean is_official
        datetime created_at
    }
    
    TENDER_RECORDS {
        integer id PK
        integer hospital_id FK
        varchar title
        enum tender_type
        date publish_date
        varchar content_hash
        enum status
        datetime created_at
    }
    
    SCAN_HISTORY {
        integer id PK
        varchar task_id
        enum scan_type
        enum target_type
        integer target_id
        enum status
        datetime start_time
        datetime created_at
    }
    
    SETTINGS {
        integer id PK
        varchar key_name
        text key_value
        enum key_type
        boolean is_editable
        datetime created_at
    }
    
    CRAWLER_LOGS {
        integer id PK
        varchar task_id
        integer hospital_id FK
        enum log_level
        text message
        datetime created_at
    }
    
    TENDER_RAW_HTML {
        integer id PK
        integer tender_record_id FK
        integer hospital_id FK
        varchar html_hash
        varchar source_url
        enum parse_status
        datetime created_at
    }

    %% å…³ç³»å®šä¹‰
    REGIONS ||--o{ REGIONS : "parent_child"
    REGIONS ||--o{ HOSPITALS : "region_hospital"
    HOSPITALS ||--o{ HOSPITAL_ALIAS : "hospital_alias"
    HOSPITALS ||--o{ TENDER_RECORDS : "hospital_tender"
    HOSPITALS ||--o{ CRAWLER_LOGS : "hospital_logs"
    HOSPITALS ||--o{ TENDER_RAW_HTML : "hospital_html"
    TENDER_RECORDS ||--o| TENDER_RAW_HTML : "tender_html"
    SCAN_HISTORY ||--o{ CRAWLER_LOGS : "task_logs"
```

### 4.2 å…³ç³»çº¦æŸè¯´æ˜
```sql
-- çº§è”åˆ é™¤è§„åˆ™
HOSPITAL_ALIAS.hospital_id â†’ HOSPITALS.id (CASCADE DELETE)
TENDER_RECORDS.hospital_id â†’ HOSPITALS.id (CASCADE DELETE)
CRAWLER_LOGS.hospital_id â†’ HOSPITALS.id (CASCADE DELETE)
TENDER_RAW_HTML.hospital_id â†’ HOSPITALS.id (CASCADE DELETE)
TENDER_RAW_HTML.tender_record_id â†’ TENDER_RECORDS.id (CASCADE DELETE)

-- é™åˆ¶åˆ é™¤è§„åˆ™
REGIONS.parent_id â†’ REGIONS.id (RESTRICT DELETE) -- é˜²æ­¢å­¤ç«‹æ•°æ®
HOSPITALS.region_id â†’ REGIONS.id (RESTRICT DELETE) -- é˜²æ­¢å­¤ç«‹æ•°æ®
```

---

## ğŸ’¾ äº”ã€æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

### 5.1 åˆ›å»ºæ•°æ®åº“è„šæœ¬
```sql
-- 01_create_database.sql
-- åˆ›å»ºæ•°æ®åº“å’ŒåŸºç¡€è¡¨ç»“æ„

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS hospital_tender_monitor 
CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE hospital_tender_monitor;

-- è®¾ç½®æ—¶åŒº
SET time_zone = '+00:00';

-- åˆ›å»ºæ‰€æœ‰è¡¨
-- (è¯¦ç»†è¡¨ç»“æ„è§ä¸Šæ–‡)
```

### 5.2 åŸºç¡€æ•°æ®åˆå§‹åŒ–
```sql
-- 02_init_basic_data.sql
-- åˆå§‹åŒ–åŸºç¡€æ•°æ®

-- 1. åˆ›å»ºå›½å®¶æ•°æ®
INSERT INTO regions (name, code, level, sort_order) VALUES 
('ä¸­åäººæ°‘å…±å’Œå›½', 'CN', 'country', 1);

-- 2. åˆ›å»ºçœçº§è¡Œæ”¿åŒºåˆ’ç¤ºä¾‹ (éƒ¨åˆ†æ•°æ®)
INSERT INTO regions (name, code, level, parent_id, sort_order) VALUES 
-- ç›´è¾–å¸‚
('åŒ—äº¬å¸‚', '110000', 'province', 1, 1),
('ä¸Šæµ·å¸‚', '310000', 'province', 1, 2),
('å¤©æ´¥å¸‚', '120000', 'province', 1, 3),
('é‡åº†å¸‚', '500000', 'province', 1, 4),

-- çœ (éƒ¨åˆ†ç¤ºä¾‹)
('æ²³åŒ—çœ', '130000', 'province', 1, 5),
('å±±è¥¿çœ', '140000', 'province', 1, 6),
('è¾½å®çœ', '210000', 'province', 1, 7),
('å‰æ—çœ', '220000', 'province', 1, 8),
('é»‘é¾™æ±Ÿçœ', '230000', 'province', 1, 9),

-- è‡ªæ²»åŒº
('å†…è’™å¤è‡ªæ²»åŒº', '150000', 'province', 1, 20),
('å¹¿è¥¿å£®æ—è‡ªæ²»åŒº', '450000', 'province', 1, 21),
('è¥¿è—è‡ªæ²»åŒº', '540000', 'province', 1, 22),
('å®å¤å›æ—è‡ªæ²»åŒº', '640000', 'province', 1, 23),
('æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº', '650000', 'province', 1, 24);

-- 3. æ’å…¥é»˜è®¤ç³»ç»Ÿé…ç½®
-- (è§settingsè¡¨åˆå§‹åŒ–)
```

### 5.3 åˆ›å»ºè§†å›¾
```sql
-- 03_create_views.sql
-- åˆ›å»ºå¸¸ç”¨è§†å›¾

-- 1. åŒ»é™¢ç»Ÿè®¡è§†å›¾
CREATE VIEW v_hospital_statistics AS
SELECT 
    r.id as region_id,
    r.name as region_name,
    r.level as region_level,
    COUNT(h.id) as total_hospitals,
    COUNT(CASE WHEN h.verified = TRUE THEN 1 END) as verified_hospitals,
    COUNT(CASE WHEN h.status = 'active' THEN 1 END) as active_hospitals,
    SUM(h.tender_count) as total_tenders,
    AVG(h.scan_success_count) as avg_scan_success
FROM regions r
LEFT JOIN hospitals h ON r.id = h.region_id
GROUP BY r.id, r.name, r.level;

-- 2. æ‹›æŠ•æ ‡ç»Ÿè®¡è§†å›¾
CREATE VIEW v_tender_statistics AS
SELECT 
    h.id as hospital_id,
    h.name as hospital_name,
    r.name as region_name,
    COUNT(t.id) as total_tenders,
    COUNT(CASE WHEN t.publish_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 END) as recent_tenders,
    COUNT(CASE WHEN t.tender_type = 'procurement' THEN 1 END) as procurement_count,
    COUNT(CASE WHEN t.tender_type = 'construction' THEN 1 END) as construction_count
FROM hospitals h
LEFT JOIN tender_records t ON h.id = t.hospital_id
LEFT JOIN regions r ON h.region_id = r.id
GROUP BY h.id, h.name, r.name;

-- 3. æ‰«æå†å²ç»Ÿè®¡è§†å›¾
CREATE VIEW v_scan_history_summary AS
SELECT 
    scan_type,
    DATE(start_time) as scan_date,
    COUNT(*) as total_tasks,
    SUM(total_count) as total_processed,
    SUM(success_count) as total_success,
    SUM(failed_count) as total_failed,
    AVG(duration_seconds) as avg_duration
FROM scan_history
WHERE status IN ('success', 'failed', 'partial')
GROUP BY scan_type, DATE(start_time);
```

---

## ğŸ”„ å…­ã€æ•°æ®è¿ç§»ç­–ç•¥

### 6.1 ç‰ˆæœ¬ç®¡ç†
```sql
-- migration_versionè¡¨
CREATE TABLE migration_version (
    version VARCHAR(50) PRIMARY KEY,
    description TEXT,
    applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    applied_by VARCHAR(100)
);
```

### 6.2 è¿ç§»è„šæœ¬ç¤ºä¾‹
```sql
-- migrations/001_add_hospital_level.sql
-- ç‰ˆæœ¬ï¼šv1.1
-- æè¿°ï¼šæ·»åŠ åŒ»é™¢ç­‰çº§å­—æ®µ

-- æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
SET @col_exists = 0;
SELECT COUNT(*) INTO @col_exists 
FROM information_schema.COLUMNS 
WHERE TABLE_SCHEMA = DATABASE() 
AND TABLE_NAME = 'hospitals' 
AND COLUMN_NAME = 'hospital_level';

-- å¦‚æœä¸å­˜åœ¨åˆ™æ·»åŠ 
SET @sql = IF(@col_exists = 0, 
    'ALTER TABLE hospitals ADD COLUMN hospital_level ENUM("unknown", "level1", "level2", "level3", "level3a") DEFAULT "unknown" COMMENT "åŒ»é™¢ç­‰çº§"',
    'SELECT "Column hospital_level already exists" as message'
);

PREPARE stmt FROM @sql;
EXECUTE stmt;
DEALLOCATE PREPARE stmt;

-- æ›´æ–°ç‰ˆæœ¬è®°å½•
INSERT INTO migration_version (version, description) 
VALUES ('v1.1', 'æ·»åŠ åŒ»é™¢ç­‰çº§å­—æ®µ');
```

### 6.3 å¤‡ä»½ç­–ç•¥
```python
# backup_strategy.py
import sqlite3
import shutil
import os
from datetime import datetime

def create_database_backup(db_path: str, backup_dir: str) -> str:
    """åˆ›å»ºæ•°æ®åº“å¤‡ä»½"""
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    backup_filename = f"hospital_monitor_backup_{timestamp}.db"
    backup_path = os.path.join(backup_dir, backup_filename)
    
    # åˆ›å»ºå¤‡ä»½ç›®å½•
    os.makedirs(backup_dir, exist_ok=True)
    
    # å¤åˆ¶æ•°æ®åº“æ–‡ä»¶
    shutil.copy2(db_path, backup_path)
    
    # å‹ç¼©å¤‡ä»½æ–‡ä»¶ (å¯é€‰)
    # compress_backup(backup_path)
    
    return backup_path

def cleanup_old_backups(backup_dir: str, keep_days: int = 30):
    """æ¸…ç†æ—§å¤‡ä»½æ–‡ä»¶"""
    cutoff_time = datetime.now().timestamp() - (keep_days * 24 * 3600)
    
    for filename in os.listdir(backup_dir):
        if filename.endswith('.db'):
            file_path = os.path.join(backup_dir, filename)
            if os.path.getmtime(file_path) < cutoff_time:
                os.remove(file_path)
```

---

## ğŸ“Š ä¸ƒã€æ•°æ®è´¨é‡ä¿è¯

### 7.1 æ•°æ®éªŒè¯è§„åˆ™
```sql
-- åˆ›å»ºæ£€æŸ¥çº¦æŸ
ALTER TABLE hospitals ADD CONSTRAINT chk_website_url 
CHECK (website_url IS NULL OR website_url REGEXP '^https?://');

ALTER TABLE tender_records ADD CONSTRAINT chk_budget_positive 
CHECK (budget_amount IS NULL OR budget_amount >= 0);

ALTER TABLE regions ADD CONSTRAINT chk_level_hierarchy 
CHECK (level IN ('country', 'province', 'city', 'county'));
```

### 7.2 æ•°æ®æ¸…ç†è„šæœ¬
```sql
-- data_cleanup.sql
-- æ¸…ç†é‡å¤å’Œæ— æ•ˆæ•°æ®

-- 1. åˆ é™¤é‡å¤çš„åŒ»é™¢è®°å½•
DELETE h1 FROM hospitals h1
INNER JOIN hospitals h2 
WHERE h1.id < h2.id 
AND h1.name = h2.name 
AND h1.region_id = h2.region_id;

-- 2. æ¸…ç†æ— æ•ˆçš„æ‹›æŠ•æ ‡è®°å½•
DELETE FROM tender_records 
WHERE publish_date > CURDATE() 
OR content_hash IS NULL 
OR content_hash = '';

-- 3. æ¸…ç†è¿‡æœŸçš„æ‰«æå†å²è®°å½• (ä¿ç•™6ä¸ªæœˆ)
DELETE FROM scan_history 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 6 MONTH);

-- 4. æ¸…ç†è¿‡æœŸçš„åŸå§‹HTML (ä¿ç•™3ä¸ªæœˆ)
DELETE FROM tender_raw_html 
WHERE expires_at < NOW();
```

### 7.3 æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
```python
# data_integrity_check.py
def check_data_integrity():
    """æ£€æŸ¥æ•°æ®å®Œæ•´æ€§"""
    checks = []
    
    # 1. æ£€æŸ¥å¤–é”®å®Œæ•´æ€§
    orphaned_hospitals = """
        SELECT COUNT(*) FROM hospitals h 
        LEFT JOIN regions r ON h.region_id = r.id 
        WHERE r.id IS NULL
    """
    checks.append(("å­¤ç«‹åŒ»é™¢è®°å½•", orphaned_hospitals))
    
    # 2. æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
    inconsistent_tenders = """
        SELECT COUNT(*) FROM tender_records t
        LEFT JOIN hospitals h ON t.hospital_id = h.id
        WHERE h.id IS NULL
    """
    checks.append(("å­¤ç«‹çš„æ‹›æŠ•æ ‡è®°å½•", inconsistent_tenders))
    
    # 3. æ£€æŸ¥æ•°æ®æ ¼å¼
    invalid_dates = """
        SELECT COUNT(*) FROM tender_records 
        WHERE publish_date > CURDATE() OR publish_date < '2000-01-01'
    """
    checks.append(("æ— æ•ˆæ—¥æœŸè®°å½•", invalid_dates))
    
    return checks
```

---

## ğŸš€ å…«ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 8.1 æŸ¥è¯¢ä¼˜åŒ–
```sql
-- 1. ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨
CREATE INDEX idx_hospitals_cover ON hospitals(region_id, status, verified, id, name);

-- 2. åˆ†åŒºè¡¨ (å¤§æ•°æ®é‡æ—¶)
-- æŒ‰å¹´ä»½åˆ†åŒºæ‹›æŠ•æ ‡è®°å½•è¡¨
ALTER TABLE tender_records PARTITION BY RANGE (YEAR(publish_date)) (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION pmax VALUES LESS THAN MAXVALUE
);

-- 3. ç‰©åŒ–è§†å›¾ (MySQL 8.0+)
CREATE MATERIALIZED VIEW mv_daily_tender_stats AS
SELECT 
    hospital_id,
    DATE(publish_date) as tender_date,
    COUNT(*) as tender_count,
    SUM(budget_amount) as total_budget
FROM tender_records
WHERE publish_date >= DATE_SUB(CURDATE(), INTERVAL 90 DAY)
GROUP BY hospital_id, DATE(publish_date);
```

### 8.2 å­˜å‚¨ä¼˜åŒ–
```sql
-- 1. å‹ç¼©å¤§å­—æ®µ
ALTER TABLE tender_raw_html MODIFY html_content LONGBLOB;

-- 2. åˆ†è¡¨ç­–ç•¥
-- æŒ‰åŒ»é™¢IDèŒƒå›´åˆ†è¡¨
CREATE TABLE tender_records_2024_01 LIKE tender_records;
CREATE TABLE tender_records_2024_02 LIKE tender_records;

-- 3. å½’æ¡£ç­–ç•¥
CREATE TABLE tender_records_archive LIKE tender_records;
```

---

## ğŸ“ ä¹ã€ç›‘æ§ä¸ç»´æŠ¤

### 9.1 ç›‘æ§æŒ‡æ ‡
```sql
-- åˆ›å»ºç›‘æ§è§†å›¾
CREATE VIEW v_system_health AS
SELECT 
    'Database Size' as metric,
    ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) as value,
    'MB' as unit,
    NOW() as timestamp
FROM information_schema.tables 
WHERE table_schema = DATABASE()

UNION ALL

SELECT 
    'Table Count' as metric,
    COUNT(*) as value,
    'tables' as unit,
    NOW() as timestamp
FROM information_schema.tables 
WHERE table_schema = DATABASE()

UNION ALL

SELECT 
    'Total Hospitals' as metric,
    COUNT(*) as value,
    'hospitals' as unit,
    NOW() as timestamp
FROM hospitals;
```

### 9.2 ç»´æŠ¤ä»»åŠ¡
```sql
-- å®šæœŸç»´æŠ¤ä»»åŠ¡
-- 1. æ¯å‘¨é‡å»ºç´¢å¼•
OPTIMIZE TABLE hospitals, tender_records, scan_history;

-- 2. æ¯æœˆåˆ†æè¡¨ç»Ÿè®¡
ANALYZE TABLE hospitals, tender_records, scan_history;

-- 3. æ£€æŸ¥å¹¶ä¿®å¤è¡¨
CHECK TABLE hospitals, tender_records, scan_history;
```

---

## ğŸ“‹ åã€éƒ¨ç½²ä¸è¿ç§»

### 10.1 SQLiteåˆ°PostgreSQLè¿ç§»
```python
# sqlite_to_postgresql_migration.py
import sqlite3
import psycopg2
from sqlalchemy import create_engine

def migrate_from_sqlite_to_postgresql():
    """SQLiteåˆ°PostgreSQLè¿ç§»è„šæœ¬"""
    
    # è¿æ¥æºæ•°æ®åº“
    sqlite_engine = create_engine('sqlite:///hospital_monitor.db')
    
    # è¿æ¥ç›®æ ‡æ•°æ®åº“
    pg_engine = create_engine('postgresql://user:password@localhost/hospital_monitor')
    
    # è¯»å–æ‰€æœ‰è¡¨
    tables = ['regions', 'hospitals', 'tender_records', 'scan_history', 'settings']
    
    for table in tables:
        # ä»SQLiteè¯»å–æ•°æ®
        data = pd.read_sql_table(table, sqlite_engine)
        
        # å†™å…¥PostgreSQL
        data.to_sql(table, pg_engine, if_exists='replace', index=False)
        
        print(f"è¿ç§»è¡¨ {table} å®Œæˆï¼Œå…± {len(data)} æ¡è®°å½•")

# ä¸»å‡½æ•°
if __name__ == "__main__":
    migrate_from_sqlite_to_postgresql()
```

---

## ğŸ¯ æ€»ç»“

æœ¬æ•°æ®åº“è®¾è®¡æ–‡æ¡£æä¾›äº†ï¼š

1. **å®Œæ•´çš„è¡¨ç»“æ„è®¾è®¡** - 8ä¸ªæ ¸å¿ƒè¡¨ï¼Œæ¶µç›–æ‰€æœ‰ä¸šåŠ¡éœ€æ±‚
2. **è¯¦ç»†çš„ç´¢å¼•ç­–ç•¥** - é’ˆå¯¹æŸ¥è¯¢æ¨¡å¼ä¼˜åŒ–çš„ç´¢å¼•è®¾è®¡  
3. **æ¸…æ™°çš„å¤–é”®å…³ç³»** - ä¿è¯æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§
4. **å®Œæ•´çš„åˆå§‹åŒ–è„šæœ¬** - æ”¯æŒå¿«é€Ÿéƒ¨ç½²å’Œæµ‹è¯•
5. **ç§‘å­¦çš„è¿ç§»ç­–ç•¥** - æ”¯æŒç‰ˆæœ¬å‡çº§å’Œæ•°æ®åº“è¿ç§»
6. **å…¨é¢çš„è´¨é‡ä¿è¯** - æ•°æ®éªŒè¯ã€æ¸…ç†å’Œç›‘æ§æœºåˆ¶
7. **æ€§èƒ½ä¼˜åŒ–å»ºè®®** - é’ˆå¯¹å¤§æ•°æ®é‡çš„æ‰©å±•æ–¹æ¡ˆ

æ•°æ®åº“è®¾è®¡éµå¾ªç¬¬ä¸‰èŒƒå¼ï¼Œåœ¨ä¿è¯æ•°æ®å®Œæ•´æ€§çš„åŒæ—¶ï¼Œé€šè¿‡åˆç†çš„ç´¢å¼•å’Œä¼˜åŒ–ç­–ç•¥ç¡®ä¿ç³»ç»Ÿæ€§èƒ½ã€‚æ‰€æœ‰è®¾è®¡éƒ½è€ƒè™‘äº†å¯æ‰©å±•æ€§ï¼Œä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•é¢„ç•™ç©ºé—´ã€‚

**ä¸‹ä¸€æ­¥ï¼š** æ ¹æ®æ­¤è®¾è®¡æ–‡æ¡£ï¼Œå¼€å§‹å®ç°å…·ä½“çš„æ•°æ®åº“è„šæœ¬å’Œä¸šåŠ¡ä»£ç ã€‚