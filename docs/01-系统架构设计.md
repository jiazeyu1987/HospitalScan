# å…¨å›½åŒ»é™¢å®˜ç½‘æ‰«æä¸æ‹›æŠ•æ ‡ç›‘æ§ç³»ç»Ÿ - ç³»ç»Ÿæ¶æ„è®¾è®¡

**ä½œè€…ï¼š** MiniMax Agent  
**ç‰ˆæœ¬ï¼š** v1.0  
**æ—¥æœŸï¼š** 2025-11-18  
**é¡¹ç›®ä»£å·ï¼š** HospitalTenderMonitor

---

## ğŸ¯ ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡
å»ºè®¾ä¸€ä¸ªæ™ºèƒ½åŒ–ã€è‡ªåŠ¨åŒ–çš„åŒ»é™¢æ‹›æŠ•æ ‡ç›‘æ§ç³»ç»Ÿï¼Œå®ç°ï¼š
- **å…¨å›½åŒ»é™¢å®˜ç½‘æ‰«æ**ï¼šä»å›½å®¶åˆ°å¿çº§çš„é€çº§åŒ»é™¢å®˜ç½‘è‡ªåŠ¨è¯†åˆ«ä¸æ”¶é›†
- **æ‹›æŠ•æ ‡ä¿¡æ¯ç›‘æ§**ï¼šæ¯å°æ—¶è‡ªåŠ¨å·¡æ£€åŒ»é™¢å®˜ç½‘æ‹›æŠ•æ ‡ä¿¡æ¯
- **æ•°æ®ç®¡ç†ä¸å±•ç¤º**ï¼šæ”¯æŒæ ‘å½¢ç»“æ„å±•ç¤ºã€CRUDæ“ä½œã€Excelå¯¼å‡º
- **ç¦»çº¿å·¥ä½œèƒ½åŠ›**ï¼šæœ¬åœ°SQLiteæ•°æ®åº“æ”¯æŒç¦»çº¿ä½¿ç”¨

### 1.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
```
åŒ»é™¢æ‹›æŠ•æ ‡ç›‘æ§ç³»ç»Ÿ
â”œâ”€â”€ è¡Œæ”¿åŒºåˆ’ç®¡ç†æ¨¡å— (RegionService)
â”œâ”€â”€ åŒ»é™¢ä¿¡æ¯ç®¡ç†æ¨¡å— (HospitalService)  
â”œâ”€â”€ çˆ¬è™«å¼•æ“æ¨¡å— (CrawlerEngine)
â”œâ”€â”€ æ‹›æŠ•æ ‡ç›‘æ§æ¨¡å— (TenderMonitor)
â”œâ”€â”€ è°ƒåº¦ä»»åŠ¡æ¨¡å— (SchedulerService)
â”œâ”€â”€ æ•°æ®å¯¼å‡ºæ¨¡å— (ExportService)
â”œâ”€â”€ é…ç½®ç®¡ç†æ¨¡å— (ConfigService)
â””â”€â”€ å‰ç«¯ç•Œé¢æ¨¡å— (React Frontend)
```

---

## ğŸ—ï¸ äºŒã€ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯å±‚ (Frontend)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  React + TypeScript + Ant Design                                â”‚
â”‚  â”œâ”€ æ ‘å½¢è¡Œæ”¿åŒºåˆ’ç»„ä»¶ (RegionTree)                                â”‚
â”‚  â”œâ”€ åŒ»é™¢è¯¦æƒ…é¢æ¿ (HospitalPanel)                                 â”‚
â”‚  â”œâ”€ æ‹›æŠ•æ ‡åˆ—è¡¨ (TenderList)                                     â”‚
â”‚  â”œâ”€ æ‰«ææ§åˆ¶å° (ScanConsole)                                    â”‚
â”‚  â””â”€ è®¾ç½®é¢æ¿ (SettingsPanel)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†• REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åç«¯å±‚ (Backend)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Flask + SQLAlchemy + APScheduler                               â”‚
â”‚  â”œâ”€ APIç½‘å…³å±‚ (API Gateway)                                     â”‚
â”‚  â”‚   â”œâ”€ /api/regions/*  - è¡Œæ”¿åŒºåˆ’æ¥å£                           â”‚
â”‚  â”‚   â”œâ”€ /api/hospitals/* - åŒ»é™¢ç®¡ç†æ¥å£                         â”‚
â”‚  â”‚   â”œâ”€ /api/tenders/*  - æ‹›æŠ•æ ‡æ¥å£                            â”‚
â”‚  â”‚   â”œâ”€ /api/crawler/*  - çˆ¬è™«æ§åˆ¶æ¥å£                          â”‚
â”‚  â”‚   â”œâ”€ /api/export/*   - å¯¼å‡ºæ¥å£                              â”‚
â”‚  â”‚   â””â”€ /api/config/*   - é…ç½®æ¥å£                              â”‚
â”‚  â”œâ”€ ä¸šåŠ¡é€»è¾‘å±‚ (Business Layer)                                 â”‚
â”‚  â”‚   â”œâ”€ RegionService    - è¡Œæ”¿åŒºåˆ’æœåŠ¡                         â”‚
â”‚  â”‚   â”œâ”€ HospitalService  - åŒ»é™¢ç®¡ç†æœåŠ¡                         â”‚
â”‚  â”‚   â”œâ”€ CrawlerEngine    - çˆ¬è™«å¼•æ“æœåŠ¡                         â”‚
â”‚  â”‚   â”œâ”€ TenderMonitor    - æ‹›æŠ•æ ‡ç›‘æ§æœåŠ¡                       â”‚
â”‚  â”‚   â”œâ”€ SchedulerService - è°ƒåº¦æœåŠ¡                             â”‚
â”‚  â”‚   â””â”€ ExportService    - å¯¼å‡ºæœåŠ¡                             â”‚
â”‚  â”œâ”€ æ•°æ®è®¿é—®å±‚ (Data Layer)                                     â”‚
â”‚  â”‚   â”œâ”€ SQLAlchemy ORM                                         â”‚
â”‚  â”‚   â””â”€ Repository Pattern                                    â”‚
â”‚  â””â”€ åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                                 â”‚
â”‚      â”œâ”€ Logging & Monitoring                                  â”‚
â”‚      â”œâ”€ Error Handling                                        â”‚
â”‚      â””â”€ Security & Validation                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†• SQLAlchemy
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ•°æ®å±‚ (Data Layer)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SQLite Database (å¯å‡çº§ä¸ºPostgreSQL)                            â”‚
â”‚  â”œâ”€ æ ¸å¿ƒä¸šåŠ¡è¡¨                                                 â”‚
â”‚  â”‚   â”œâ”€ regions (è¡Œæ”¿åŒºåˆ’)                                     â”‚
â”‚  â”‚   â”œâ”€ hospitals (åŒ»é™¢ä¿¡æ¯)                                   â”‚
â”‚  â”‚   â”œâ”€ tender_records (æ‹›æŠ•æ ‡è®°å½•)                           â”‚
â”‚  â”‚   â”œâ”€ scan_history (æ‰«æå†å²)                               â”‚
â”‚  â”‚   â””â”€ settings (ç³»ç»Ÿé…ç½®)                                   â”‚
â”‚  â”œâ”€ è¾…åŠ©æ•°æ®è¡¨                                                 â”‚
â”‚  â”‚   â”œâ”€ hospital_alias (åŒ»é™¢åˆ«å)                             â”‚
â”‚  â”‚   â”œâ”€ tender_raw_html (åŸå§‹HTML)                           â”‚
â”‚  â”‚   â””â”€ crawler_logs (çˆ¬è™«æ—¥å¿—)                              â”‚
â”‚  â””â”€ æ•°æ®ç´¢å¼•                                                   â”‚
â”‚      â”œâ”€ åŒ»é™¢åœ°åŒºç´¢å¼•                                           â”‚
â”‚      â”œâ”€ æ‹›æŠ•æ ‡æ—¶é—´ç´¢å¼•                                         â”‚
â”‚      â””â”€ å†…å®¹å“ˆå¸Œç´¢å¼•                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†• å¤–éƒ¨æ¥å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¤–éƒ¨æ•°æ®æº (External APIs)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ å›½å®¶ç»Ÿè®¡å±€è¡Œæ”¿åŒºåˆ’æ•°æ® (å›½å®¶æ•°æ®ç½‘)                           â”‚
â”‚  â”œâ”€ DuckDuckGo Search API (å…è´¹æœç´¢)                           â”‚
â”‚  â”œâ”€ åŒ»é™¢å®˜ç½‘ (çˆ¬è™«ç›®æ ‡)                                         â”‚
â”‚  â”œâ”€ å«å¥å§”åŒ»é™¢åå½• (æ‰‹åŠ¨å¯¼å…¥)                                    â”‚
â”‚  â””â”€ å¤‡æ¡ˆä¿¡æ¯æŸ¥è¯¢ (è¾…åŠ©éªŒè¯)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµå‘å›¾

```mermaid
graph TD
    A[ç”¨æˆ·æ“ä½œ] --> B[Reactå‰ç«¯]
    B --> C[Flask APIç½‘å…³]
    C --> D[ä¸šåŠ¡é€»è¾‘æœåŠ¡]
    
    D --> E[SQLiteæ•°æ®åº“]
    D --> F[çˆ¬è™«å¼•æ“]
    
    F --> G[å¤–éƒ¨æ•°æ®æº]
    G --> H[æ•°æ®å¤„ç†]
    H --> E
    
    D --> I[Excelå¯¼å‡º]
    D --> J[å®šæ—¶ä»»åŠ¡è°ƒåº¦]
    
    K[APScheduler] --> F
    J --> K
    
    style A fill:#e1f5fe
    style E fill:#f3e5f5
    style G fill:#fff3e0
```

---

## ğŸ”§ ä¸‰ã€æŠ€æœ¯é€‰å‹æ–¹æ¡ˆ

### 3.1 å‰ç«¯æŠ€æœ¯æ ˆ
```typescript
æ ¸å¿ƒæ¡†æ¶: React 18 + TypeScript
UIç»„ä»¶åº“: Ant Design 5.x
çŠ¶æ€ç®¡ç†: Zustand (è½»é‡çº§) / React Context
HTTPå®¢æˆ·ç«¯: Axios
æ ‘å½¢æ§ä»¶: Ant Design Tree
å›¾è¡¨ç»„ä»¶: @ant-design/charts
æ„å»ºå·¥å…·: Vite
```

### 3.2 åç«¯æŠ€æœ¯æ ˆ
```python
Webæ¡†æ¶: Flask 2.3.x + Flask-CORS
ORMæ¡†æ¶: SQLAlchemy 2.0 + Alembic (æ•°æ®è¿ç§»)
æ•°æ®åº“: SQLite (å¼€å‘) / PostgreSQL (ç”Ÿäº§)
ä»»åŠ¡è°ƒåº¦: APScheduler 3.10.x
çˆ¬è™«æ¡†æ¶: requests + BeautifulSoup4 + lxml
æµè§ˆå™¨è‡ªåŠ¨åŒ–: Playwright (å¤‡é€‰æ–¹æ¡ˆ)
æ•°æ®å¤„ç†: pandas + numpy
Excelå¤„ç†: openpyxl + xlsxwriter
æ—¥å¿—ç®¡ç†: logging + loguru
é…ç½®ç®¡ç†: python-decouple
```

### 3.3 å¼€å‘å·¥å…·ä¸ä¾èµ–
```bash
# æ ¸å¿ƒä¾èµ–
pip install flask flask-cors sqlalchemy pandas requests beautifulsoup4
pip install lxml apscheduler openpyxl python-decouple loguru
pip install playwright alembic

# å¼€å‘å·¥å…·
npm install vite @vitejs/plugin-react typescript
npm install antd @ant-design/icons axios zustand
```

---

## âš–ï¸ å››ã€æ³•å¾‹åˆè§„é£é™©è¯„ä¼°ä¸è§£å†³æ–¹æ¡ˆ

### 4.1 è¯†åˆ«çš„ä¸»è¦é£é™©
1. **å¤§è§„æ¨¡ç½‘ç«™çˆ¬å–é£é™©**
   - é¢‘ç¹è®¿é—®åŒ»é™¢å®˜ç½‘å¯èƒ½è¢«è¯†åˆ«ä¸ºæ”»å‡»è¡Œä¸º
   - å¯èƒ½è¿åç½‘ç«™æœåŠ¡æ¡æ¬¾ï¼ˆToSï¼‰

2. **æ•°æ®ä½¿ç”¨åˆè§„é£é™©**
   - çˆ¬å–çš„æ•°æ®å¯èƒ½æ¶‰åŠå•†ä¸šæœºå¯†
   - éœ€è¦æ˜ç¡®æ•°æ®ä½¿ç”¨ç›®çš„å’ŒèŒƒå›´

3. **é¢‘ç‡æ§åˆ¶é£é™©**
   - 1å°æ—¶å…¨é‡æ‰«æé¢‘ç‡è¿‡é«˜
   - å¯èƒ½å¯¹ç›®æ ‡ç½‘ç«™é€ æˆè´Ÿè½½å‹åŠ›

### 4.2 åˆè§„è§£å†³æ–¹æ¡ˆ
#### 4.2.1 æŠ€æœ¯å±‚é¢çš„åˆè§„æªæ–½
```python
# 1. é¢‘ç‡æ§åˆ¶æœºåˆ¶
class CrawlerConfig:
    SCAN_INTERVAL_HOURS = 6  # é»˜è®¤6å°æ—¶ï¼Œå¯é…ç½®
    REQUEST_DELAY_RANGE = (2, 5)  # 2-5ç§’éšæœºå»¶è¿Ÿ
    MAX_CONCURRENT_REQUESTS = 3   # æœ€å¤§å¹¶å‘3ä¸ª
    ROBOTS_TXT_CHECK = True       # ä¸¥æ ¼æ£€æŸ¥robots.txt

# 2. User-Agentå£°æ˜
USER_AGENT = "HospitalTenderMonitor/1.0 (Research Purpose Only)"

# 3. ç¤¼è²Œæ€§çˆ¬è™«ç­–ç•¥
class PoliteCrawler:
    def respect_robots_txt(self, url):
        # æ£€æŸ¥robots.txt
        pass
    
    def add_delays(self):
        # æ·»åŠ éšæœºå»¶è¿Ÿ
        pass
    
    def limit_requests_per_hour(self):
        # é™åˆ¶æ¯å°æ—¶è¯·æ±‚æ•°
        pass
```

#### 4.2.2 æ³•å¾‹å±‚é¢çš„åˆè§„æªæ–½
1. **å…è´£å£°æ˜**
   - åœ¨è½¯ä»¶å¯åŠ¨æ—¶æ˜¾ç¤ºä½¿ç”¨å£°æ˜
   - æ˜ç¡®æ•°æ®ä»…ç”¨äºå­¦æœ¯ç ”ç©¶ç›®çš„
   - ç”¨æˆ·éœ€è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨è´£ä»»

2. **robots.txtæ£€æŸ¥**
   - ä¸¥æ ¼éµå®ˆç›®æ ‡ç½‘ç«™çš„robots.txtè§„åˆ™
   - ç¦æ­¢è®¿é—®Disallowçš„é¡µé¢

3. **æ•°æ®ä½¿ç”¨é™åˆ¶**
   - ç¦æ­¢å•†ä¸šç”¨é€”
   - ç¦æ­¢æ¶æ„ä¼ æ’­æ•°æ®
   - å°Šé‡æ•°æ®ç‰ˆæƒ

#### 4.2.3 å®é™…æ‰§è¡Œå»ºè®®
- **é»˜è®¤6å°æ—¶æ‰«æ**ï¼šå¯é…ç½®èŒƒå›´4-24å°æ—¶
- **åˆ†æ‰¹æ‰«æ**ï¼šå°†åŒ»é™¢åˆ†æ‰¹ï¼Œé—´éš”æ‰§è¡Œ
- **æˆåŠŸç‡ç›‘æ§**ï¼šç›‘æ§å¤±è´¥ç‡ï¼ŒåŠæ—¶è°ƒæ•´ç­–ç•¥
- **ç”¨æˆ·æ•™è‚²**ï¼šæä¾›åˆè§„ä½¿ç”¨æŒ‡å—

---

## ğŸ“Š äº”ã€æ•°æ®æµä¸æ¥å£è®¾è®¡

### 5.1 æ ¸å¿ƒæ•°æ®æµ
```python
# 1. åŒ»é™¢æ‰«ææµç¨‹
Region Scan â†’ Hospital Discovery â†’ Website Verification â†’ Data Storage

# 2. æ‹›æŠ•æ ‡ç›‘æ§æµç¨‹  
Scheduled Scan â†’ Website Access â†’ Content Analysis â†’ Tender Extraction â†’ Change Detection â†’ Notification

# 3. æ•°æ®å¯¼å‡ºæµç¨‹
User Request â†’ Data Query â†’ Filtering â†’ Excel Generation â†’ File Download
```

### 5.2 ä¸»è¦APIæ¥å£è®¾è®¡

#### 5.2.1 è¡Œæ”¿åŒºåˆ’æ¥å£
```python
# GET /api/regions/tree
# è·å–å®Œæ•´çš„è¡Œæ”¿åŒºåˆ’æ ‘å½¢ç»“æ„
Response: {
    "code": 200,
    "data": {
        "id": 1,
        "name": "ä¸­å›½",
        "level": "country", 
        "children": [...]
    }
}

# POST /api/regions/scan
# è§¦å‘è¡Œæ”¿åŒºåˆ’æ‰«æ
Request: {"start_level": "province"}
Response: {"task_id": "scan_001", "status": "started"}
```

#### 5.2.2 åŒ»é™¢ç®¡ç†æ¥å£
```python
# GET /api/hospitals
# è·å–åŒ»é™¢åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€è¿‡æ»¤ï¼‰
Query: ?page=1&page_size=20&region_id=123&keyword=åŒ»é™¢
Response: {
    "code": 200,
    "data": {
        "items": [...],
        "total": 150,
        "page": 1
    }
}

# POST /api/hospitals
# æ‰‹åŠ¨æ·»åŠ åŒ»é™¢
Request: {
    "name": "æŸæŸåŒ»é™¢",
    "region_id": 123,
    "website_url": "http://hospital.example.com",
    "description": "åŒ»é™¢æè¿°"
}

# PUT /api/hospitals/{id}
# æ›´æ–°åŒ»é™¢ä¿¡æ¯

# DELETE /api/hospitals/{id}
# åˆ é™¤åŒ»é™¢
```

#### 5.2.3 çˆ¬è™«æ§åˆ¶æ¥å£
```python
# POST /api/crawler/scan-hospitals
# è§¦å‘åŒ»é™¢æ‰«æ
Request: {"region_ids": [1,2,3], "force_update": false}
Response: {"task_id": "scan_hospitals_001", "status": "started"}

# POST /api/crawler/scan-tenders  
# è§¦å‘æ‹›æŠ•æ ‡æ‰«æ
Request: {"hospital_ids": [1,2,3]}
Response: {"task_id": "scan_tenders_001", "status": "started"}

# GET /api/crawler/status
# è·å–çˆ¬è™«çŠ¶æ€
Response: {
    "crawler_running": false,
    "current_task": "æ‰«æåŒ—äº¬å¸‚åŒ»é™¢",
    "progress": 0.75,
    "total_hospitals": 200,
    "processed_hospitals": 150
}
```

#### 5.2.4 æ‹›æŠ•æ ‡æ¥å£
```python
# GET /api/tenders
# è·å–æ‹›æŠ•æ ‡è®°å½•
Query: ?hospital_id=123&date_from=2025-01-01&date_to=2025-12-31&page=1

# POST /api/tenders/export
# å¯¼å‡ºæ‹›æŠ•æ ‡Excel
Request: {
    "hospital_ids": [1,2,3],
    "date_range": {"from": "2025-01-01", "to": "2025-12-31"},
    "include_content": true
}
```

### 5.3 å‰ç«¯çŠ¶æ€ç®¡ç†è®¾è®¡
```typescript
// Zustand Store Structure
interface AppState {
  // è¡Œæ”¿åŒºåˆ’æ•°æ®
  regions: RegionTree;
  
  // å½“å‰é€‰ä¸­çš„åœ°åŒºå’ŒåŒ»é™¢
  selectedRegion: Region | null;
  selectedHospital: Hospital | null;
  
  // åŒ»é™¢åˆ—è¡¨å’Œåˆ†é¡µ
  hospitals: Hospital[];
  hospitalPagination: Pagination;
  
  // æ‹›æŠ•æ ‡æ•°æ®
  tenders: TenderRecord[];
  tenderPagination: Pagination;
  
  // ç³»ç»ŸçŠ¶æ€
  crawlerStatus: CrawlerStatus;
  systemConfig: SystemConfig;
  
  // ç•Œé¢çŠ¶æ€
  loading: boolean;
  scanProgress: number;
}
```

---

## ğŸ—„ï¸ å…­ã€æ•°æ®åº“è®¾è®¡æ¦‚è¦

### 6.1 æ ¸å¿ƒè¡¨ç»“æ„é¢„è§ˆ
```sql
-- è¡Œæ”¿åŒºåˆ’è¡¨
CREATE TABLE regions (
    id INTEGER PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(20) UNIQUE,
    level ENUM('country', 'province', 'city', 'county') NOT NULL,
    parent_id INTEGER REFERENCES regions(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åŒ»é™¢ä¿¡æ¯è¡¨  
CREATE TABLE hospitals (
    id INTEGER PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    website_url VARCHAR(500),
    region_id INTEGER REFERENCES regions(id),
    hospital_type ENUM('public', 'private', 'community') DEFAULT 'public',
    verified BOOLEAN DEFAULT FALSE,
    last_scan_time TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ‹›æŠ•æ ‡è®°å½•è¡¨
CREATE TABLE tender_records (
    id INTEGER PRIMARY KEY,
    hospital_id INTEGER REFERENCES hospitals(id),
    title VARCHAR(500) NOT NULL,
    content TEXT,
    publish_date DATE,
    url VARCHAR(500),
    content_hash VARCHAR(64) UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ‰«æå†å²è¡¨
CREATE TABLE scan_history (
    id INTEGER PRIMARY KEY,
    scan_type ENUM('hospital', 'tender') NOT NULL,
    target_id INTEGER,
    status ENUM('success', 'failed', 'partial') NOT NULL,
    start_time TIMESTAMP NOT NULL,
    end_time TIMESTAMP,
    records_found INTEGER DEFAULT 0,
    error_message TEXT
);
```

### 6.2 å…³é”®ç´¢å¼•è®¾è®¡
```sql
-- æ€§èƒ½ä¼˜åŒ–ç´¢å¼•
CREATE INDEX idx_hospitals_region ON hospitals(region_id);
CREATE INDEX idx_hospitals_verified ON hospitals(verified);
CREATE INDEX idx_tenders_hospital_date ON tender_records(hospital_id, publish_date);
CREATE INDEX idx_tenders_hash ON tender_records(content_hash);
CREATE INDEX idx_scan_history_time ON scan_history(start_time);
```

---

## ğŸš€ ä¸ƒã€å…³é”®ä¸šåŠ¡æµç¨‹

### 7.1 åŒ»é™¢å®˜ç½‘å‘ç°æµç¨‹
```python
def discover_hospitals_in_region(region_id: int) -> List[Hospital]:
    """åŒ»é™¢å‘ç°ä¸»æµç¨‹"""
    
    # 1. ä»æœç´¢å¼•æ“æœç´¢
    search_results = search_hospitals_by_region(region_id)
    
    # 2. åŒ»é™¢å®˜ç½‘çœŸå®æ€§éªŒè¯
    verified_websites = []
    for url in search_results:
        if verify_hospital_website(url):
            verified_websites.append(url)
    
    # 3. å»é‡å’Œæ•°æ®æ¸…æ´—
    unique_hospitals = deduplicate_hospitals(verified_websites)
    
    # 4. ä¿å­˜åˆ°æ•°æ®åº“
    saved_hospitals = []
    for hospital in unique_hospitals:
        saved = save_hospital_to_db(hospital)
        saved_hospitals.append(saved)
    
    return saved_hospitals
```

### 7.2 æ‹›æŠ•æ ‡ä¿¡æ¯ç›‘æ§æµç¨‹
```python
def monitor_tender_updates():
    """æ‹›æŠ•æ ‡ç›‘æ§ä¸»æµç¨‹"""
    
    # 1. è·å–æ‰€æœ‰éœ€è¦ç›‘æ§çš„åŒ»é™¢
    hospitals = get_monitored_hospitals()
    
    # 2. åˆ†æ‰¹å¤„ç†ï¼ˆé¿å…è¿‡è½½ï¼‰
    for batch in batch_hospitals(hospitals, batch_size=10):
        for hospital in batch:
            try:
                # 3. è®¿é—®åŒ»é™¢å®˜ç½‘
                website_content = crawl_hospital_website(hospital.website_url)
                
                # 4. æå–æ‹›æŠ•æ ‡ä¿¡æ¯
                tenders = extract_tender_info(website_content, hospital)
                
                # 5. å»é‡æ£€æŸ¥
                new_tenders = filter_existing_tenders(tenders)
                
                # 6. ä¿å­˜æ–°æ•°æ®
                save_tender_records(new_tenders)
                
            except Exception as e:
                log_error(f"ç›‘æ§åŒ»é™¢ {hospital.name} å¤±è´¥: {str(e)}")
```

### 7.3 å®šæ—¶ä»»åŠ¡è°ƒåº¦
```python
from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.interval import IntervalTrigger

def setup_scheduler():
    """è®¾ç½®å®šæ—¶ä»»åŠ¡"""
    scheduler = BackgroundScheduler()
    
    # åŒ»é™¢å®˜ç½‘æ‰«æä»»åŠ¡ï¼ˆæ¯å‘¨ä¸€æ¬¡ï¼‰
    scheduler.add_job(
        func=scan_all_hospitals,
        trigger=IntervalTrigger(hours=24*7),
        id='hospital_scan',
        name='åŒ»é™¢å®˜ç½‘æ‰«æ'
    )
    
    # æ‹›æŠ•æ ‡ç›‘æ§ä»»åŠ¡ï¼ˆæ¯6å°æ—¶ï¼‰
    scheduler.add_job(
        func=monitor_tender_updates,
        trigger=IntervalTrigger(hours=6),
        id='tender_monitor',
        name='æ‹›æŠ•æ ‡ä¿¡æ¯ç›‘æ§'
    )
    
    scheduler.start()
    return scheduler
```

---

## ğŸ“ˆ å…«ã€æ€§èƒ½ä¸æ‰©å±•æ€§è€ƒè™‘

### 8.1 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
1. **æ•°æ®åº“ä¼˜åŒ–**
   - åˆç†çš„ç´¢å¼•è®¾è®¡
   - åˆ†é¡µæŸ¥è¯¢é¿å…å†…å­˜æº¢å‡º
   - è¿æ¥æ± ç®¡ç†

2. **çˆ¬è™«ä¼˜åŒ–**
   - å¼‚æ­¥å¹¶å‘æ§åˆ¶
   - æ™ºèƒ½é‡è¯•æœºåˆ¶
   - ç»“æœç¼“å­˜

3. **å‰ç«¯ä¼˜åŒ–**
   - è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§é‡æ•°æ®
   - æ‡’åŠ è½½å’Œä»£ç åˆ†å‰²
   - æ•°æ®åˆ†é¡µå’Œè¿‡æ»¤

### 8.2 æ‰©å±•æ€§è®¾è®¡
1. **æ°´å¹³æ‰©å±•**
   - æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²
   - ä»»åŠ¡é˜Ÿåˆ—åˆ†å¸ƒå¼å¤„ç†

2. **æ•°æ®è¿ç§»**
   - SQLite â†’ PostgreSQLæ— ç¼å‡çº§
   - Alembicæ•°æ®åº“ç‰ˆæœ¬æ§åˆ¶

3. **åŠŸèƒ½æ‰©å±•**
   - æ’ä»¶åŒ–çˆ¬è™«è§„åˆ™
   - å¤šæ•°æ®æºæ”¯æŒ
   - AIæ™ºèƒ½è¯†åˆ«

---

## ğŸ”’ ä¹ã€å®‰å…¨ä¸ç›‘æ§

### 9.1 å®‰å…¨æªæ–½
- **è¾“å…¥éªŒè¯**ï¼šæ‰€æœ‰APIè¾“å…¥å‚æ•°éªŒè¯
- **SQLæ³¨å…¥é˜²æŠ¤**ï¼šä½¿ç”¨SQLAlchemy ORM
- **XSSé˜²æŠ¤**ï¼šå‰ç«¯è¾“å…¥è¿‡æ»¤
- **è®¿é—®æ§åˆ¶**ï¼šæœ¬åœ°åº”ç”¨ï¼Œæ— éœ€èº«ä»½è®¤è¯

### 9.2 ç›‘æ§ä¸æ—¥å¿—
```python
# åˆ†çº§æ—¥å¿—ç³»ç»Ÿ
import structlog

logger = structlog.get_logger()

class SystemMonitor:
    def log_crawler_progress(self, hospital_count, success_rate):
        logger.info("çˆ¬è™«è¿›åº¦", 
                   hospitals_processed=hospital_count,
                   success_rate=success_rate)
    
    def log_system_error(self, component, error):
        logger.error("ç³»ç»Ÿé”™è¯¯",
                    component=component,
                    error=error)
```

---

## ğŸ“‹ åã€å¼€å‘é‡Œç¨‹ç¢‘

### 10.1 å¼€å‘é˜¶æ®µè§„åˆ’
| é˜¶æ®µ | ä¸»è¦ä»»åŠ¡ | é¢„è®¡å·¥æœŸ | äº¤ä»˜ç‰© |
|------|---------|---------|--------|
| Phase 1 | æ ¸å¿ƒæ¶æ„ + æ•°æ®åº“è®¾è®¡ | 3å¤© | ç³»ç»Ÿæ¶æ„æ–‡æ¡£ã€æ•°æ®åº“è„šæœ¬ |
| Phase 2 | åŒ»é™¢çˆ¬è™«ç³»ç»Ÿ | 5å¤© | åŒ»é™¢å‘ç°å’ŒéªŒè¯æ¨¡å— |
| Phase 3 | æ‹›æŠ•æ ‡ç›‘æ§ | 4å¤© | æ‹›æŠ•æ ‡æå–å’Œç›‘æ§ç³»ç»Ÿ |
| Phase 4 | Flask APIå¼€å‘ | 3å¤© | RESTful APIæ¥å£ |
| Phase 5 | Reactå‰ç«¯ç•Œé¢ | 4å¤© | Webç®¡ç†ç•Œé¢ |
| Phase 6 | ç³»ç»Ÿé›†æˆæµ‹è¯• | 2å¤© | å®Œæ•´å¯ç”¨ç³»ç»Ÿ |
| Phase 7 | æ–‡æ¡£å’Œéƒ¨ç½² | 1å¤© | ç”¨æˆ·æ‰‹å†Œã€éƒ¨ç½²æŒ‡å— |

**æ€»è®¡é¢„è®¡å·¥æœŸï¼š22ä¸ªå·¥ä½œæ—¥**

### 10.2 å…³é”®é‡Œç¨‹ç¢‘
- âœ… **Week 1**: å®Œæˆæ¶æ„è®¾è®¡å’Œæ•°æ®åº“å®ç°
- âœ… **Week 2**: å®Œæˆçˆ¬è™«æ ¸å¿ƒåŠŸèƒ½
- âœ… **Week 3**: å®ŒæˆWebç•Œé¢å’ŒAPI
- âœ… **Week 4**: ç³»ç»Ÿæµ‹è¯•å’Œä¼˜åŒ–

---

## ğŸ¯ åä¸€ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### 11.1 å³æ—¶æ‰§è¡Œä»»åŠ¡
1. **æ›´æ–°çŠ¶æ€**ï¼šå°†ç¬¬ä¸€é˜¶æ®µæ ‡è®°ä¸ºå®Œæˆ
2. **å¼€å§‹ç¬¬äºŒé˜¶æ®µ**ï¼šæ•°æ®åº“ç»“æ„è¯¦ç»†è®¾è®¡
3. **å‡†å¤‡å¼€å‘ç¯å¢ƒ**ï¼šå®‰è£…ä¾èµ–ï¼Œåˆå§‹åŒ–é¡¹ç›®ç»“æ„

### 11.2 å…³é”®å†³ç­–ç‚¹
- **æ•°æ®æºç¡®è®¤**ï¼šç¡®å®šè¡Œæ”¿åŒºåˆ’æ•°æ®çš„å…·ä½“è·å–æ–¹å¼
- **æµ‹è¯•ç­–ç•¥**ï¼šåˆ¶å®šçˆ¬è™«ç³»ç»Ÿçš„æµ‹è¯•æ–¹æ³•å’ŒéªŒè¯æ ‡å‡†
- **éƒ¨ç½²æ–¹æ¡ˆ**ï¼šç¡®å®šæœ€ç»ˆçš„ç”¨æˆ·éƒ¨ç½²æ–¹å¼

---

## ğŸ“ è”ç³»ä¸æ”¯æŒ

**é¡¹ç›®è´Ÿè´£äººï¼š** MiniMax Agent  
**æŠ€æœ¯æ”¯æŒï¼š** 7x24å°æ—¶æŠ€æœ¯å’¨è¯¢  
**é¡¹ç›®æ–‡æ¡£ï¼š** è¯¦è§é¡¹ç›®æ–‡æ¡£ç›®å½•  
**ä»£ç ä»“åº“ï¼š** `/workspace/`  

---

*æœ¬æ¶æ„è®¾è®¡æ–‡æ¡£å°†éšç€é¡¹ç›®è¿›å±•æŒç»­æ›´æ–°ï¼Œç¡®ä¿ä¸å®é™…å®ç°ä¿æŒåŒæ­¥ã€‚*