"""
基础数据初始化脚本

根据数据库设计文档，初始化系统中需要的基础数据，
包括行政区划数据、系统配置等。

作者：MiniMax Agent
版本：v1.0
日期：2025-11-18
"""

import os
import json
from datetime import datetime
from app.models import Region, Settings
from app import db

def init_basic_data():
    """初始化基础数据"""
    
    print("开始初始化基础数据...")
    
    # 初始化行政区划数据
    init_regions_data()
    
    # 初始化系统设置
    init_system_settings()
    
    # 提交事务
    db.session.commit()
    print("基础数据初始化完成!")

def init_regions_data():
    """初始化行政区划数据"""
    
    # 检查是否已有数据
    if Region.query.count() > 0:
        print("行政区划数据已存在，跳过初始化")
        return
    
    print("正在加载行政区划数据...")
    
    # 中国行政区划数据（简化版本，实际项目应使用完整数据）
    china_regions = {
        'country': {
            'name': '中华人民共和国',
            'code': '100000',
            'children': {
                '110000': {  # 北京市
                    'name': '北京市',
                    'children': {
                        '110100': {'name': '东城区'},
                        '110200': {'name': '西城区'},
                        '110300': {'name': '朝阳区'},
                        '110400': {'name': '丰台区'},
                        '110500': {'name': '石景山区'},
                        '110600': {'name': '海淀区'},
                        '110700': {'name': '门头沟区'},
                        '110800': {'name': '房山区'},
                        '110900': {'name': '通州区'},
                        '111000': {'name': '顺义区'},
                        '111100': {'name': '昌平区'},
                        '111200': {'name': '大兴区'},
                        '111300': {'name': '怀柔区'},
                        '111400': {'name': '平谷区'},
                        '112100': {'name': '密云区'},
                        '112200': {'name': '延庆区'}
                    }
                },
                '120000': {  # 天津市
                    'name': '天津市',
                    'children': {
                        '120100': {'name': '和平区'},
                        '120200': {'name': '河东区'},
                        '120300': {'name': '河西区'},
                        '120400': {'name': '南开区'},
                        '120500': {'name': '河北区'},
                        '120600': {'name': '红桥区'},
                        '120700': {'name': '东丽区'},
                        '120800': {'name': '西青区'},
                        '120900': {'name': '津南区'},
                        '121000': {'name': '北辰区'},
                        '121100': {'name': '武清区'},
                        '121200': {'name': '宝坻区'},
                        '121300': {'name': '滨海新区'},
                        '121400': {'name': '宁河区'},
                        '121500': {'name': '静海区'},
                        '122500': {'name': '蓟州区'}
                    }
                },
                '310000': {  # 上海市
                    'name': '上海市',
                    'children': {
                        '310100': {'name': '黄浦区'},
                        '310200': {'name': '徐汇区'},
                        '310300': {'name': '长宁区'},
                        '310400': {'name': '静安区'},
                        '310500': {'name': '普陀区'},
                        '310600': {'name': '虹口区'},
                        '310700': {'name': '杨浦区'},
                        '310900': {'name': '闵行区'},
                        '311000': {'name': '宝山区'},
                        '311200': {'name': '嘉定区'},
                        '311300': {'name': '浦东新区'},
                        '311400': {'name': '金山区'},
                        '311500': {'name': '松江区'},
                        '311600': {'name': '青浦区'},
                        '311700': {'name': '奉贤区'},
                        '313000': {'name': '崇明区'}
                    }
                },
                '500000': {  # 重庆市
                    'name': '重庆市',
                    'children': {
                        '500100': {'name': '万州区'},
                        '500200': {'name': '涪陵区'},
                        '500300': {'name': '渝中区'},
                        '500400': {'name': '大渡口区'},
                        '500500': {'name': '江北区'},
                        '500600': {'name': '沙坪坝区'},
                        '500700': {'name': '九龙坡区'},
                        '500800': {'name': '南岸区'},
                        '500900': {'name': '北碚区'},
                        '501000': {'name': '綦江区'},
                        '501100': {'name': '大足区'},
                        '501200': {'name': '渝北区'},
                        '501300': {'name': '巴南区'},
                        '501400': {'name': '黔江区'},
                        '501500': {'name': '长寿区'},
                        '501600': {'name': '江津区'},
                        '501700': {'name': '合川区'},
                        '501800': {'name': '永川区'},
                        '501900': {'name': '南川区'},
                        '502000': {'name': '璧山区'},
                        '502100': {'name': '铜梁区'},
                        '502200': {'name': '潼南区'},
                        '502300': {'name': '荣昌区'},
                        '502400': {'name': '开州区'},
                        '502500': {'name': '梁平区'},
                        '502600': {'name': '武隆区'}
                    }
                },
                '130000': {  # 河北省
                    'name': '河北省',
                    'children': {
                        '130100': {'name': '石家庄市', 'children': {
                            '130102': {'name': '长安区'},
                            '130104': {'name': '桥西区'},
                            '130105': {'name': '新华区'},
                            '130107': {'name': '井陉矿区'},
                            '130108': {'name': '裕华区'},
                            '130109': {'name': '藁城区'},
                            '130110': {'name': '鹿泉区'},
                            '130111': {'name': '栾城区'},
                            '130121': {'name': '井陉县'},
                            '130123': {'name': '正定县'},
                            '130125': {'name': '行唐县'},
                            '130127': {'name': '灵寿县'},
                            '130129': {'name': '高邑县'},
                            '130131': {'name': '深泽县'},
                            '130132': {'name': '赞皇县'},
                            '130133': {'name': '无极县'},
                            '130134': {'name': '平山县'},
                            '130135': {'name': '元氏县'},
                            '130136': {'name': '赵县'},
                            '130172': {'name': '石家庄高新技术产业开发区'},
                            '130173': {'name': '石家庄循环化工园区'},
                            '130174': {'name': '辛集市'},
                            '130181': {'name': '晋州市'},
                            '130183': {'name': '新乐市'}
                        }},
                        '130200': {'name': '唐山市'},
                        '130300': {'name': '秦皇岛市'},
                        '130400': {'name': '邯郸市'},
                        '130500': {'name': '邢台市'},
                        '130600': {'name': '保定市'},
                        '130700': {'name': '张家口市'},
                        '130800': {'name': '承德市'},
                        '130900': {'name': '沧州市'},
                        '131000': {'name': '廊坊市'},
                        '131100': {'name': '衡水市'}
                    }
                },
                '140000': {  # 山西省
                    'name': '山西省',
                    'children': {
                        '140100': {'name': '太原市'},
                        '140200': {'name': '大同市'},
                        '140300': {'name': '阳泉市'},
                        '140400': {'name': '长治市'},
                        '140500': {'name': '晋城市'},
                        '140600': {'name': '朔州市'},
                        '140700': {'name': '晋中市'},
                        '140800': {'name': '运城市'},
                        '140900': {'name': '忻州市'},
                        '141000': {'name': '临汾市'},
                        '141100': {'name': '吕梁市'}
                    }
                },
                '150000': {  # 内蒙古自治区
                    'name': '内蒙古自治区',
                    'children': {
                        '150100': {'name': '呼和浩特市'},
                        '150200': {'name': '包头市'},
                        '150300': {'name': '乌海市'},
                        '150400': {'name': '赤峰市'},
                        '150500': {'name': '通辽市'},
                        '150600': {'name': '鄂尔多斯市'},
                        '150700': {'name': '呼伦贝尔市'},
                        '150800': {'name': '巴彦淖尔市'},
                        '150900': {'name': '乌兰察布市'},
                        '152200': {'name': '兴安盟'},
                        '152500': {'name': '锡林郭勒盟'},
                        '152900': {'name': '阿拉善盟'}
                    }
                },
                '210000': {  # 辽宁省
                    'name': '辽宁省',
                    'children': {
                        '210100': {'name': '沈阳市'},
                        '210200': {'name': '大连市'},
                        '210300': {'name': '鞍山市'},
                        '210400': {'name': '抚顺市'},
                        '210500': {'name': '本溪市'},
                        '210600': {'name': '丹东市'},
                        '210700': {'name': '锦州市'},
                        '210800': {'name': '营口市'},
                        '210900': {'name': '阜新市'},
                        '211000': {'name': '辽阳市'},
                        '211100': {'name': '盘锦市'},
                        '211200': {'name': '铁岭市'},
                        '211300': {'name': '朝阳市'},
                        '211400': {'name': '葫芦岛市'}
                    }
                },
                '220000': {  # 吉林省
                    'name': '吉林省',
                    'children': {
                        '220100': {'name': '长春市'},
                        '220200': {'name': '吉林市'},
                        '220300': {'name': '四平市'},
                        '220400': {'name': '辽源市'},
                        '220500': {'name': '通化市'},
                        '220600': {'name': '白山市'},
                        '220700': {'name': '松原市'},
                        '220800': {'name': '白城市'},
                        '222400': {'name': '延边朝鲜族自治州'}
                    }
                },
                '230000': {  # 黑龙江省
                    'name': '黑龙江省',
                    'children': {
                        '230100': {'name': '哈尔滨市'},
                        '230200': {'name': '齐齐哈尔市'},
                        '230300': {'name': '鸡西市'},
                        '230400': {'name': '鹤岗市'},
                        '230500': {'name': '双鸭山市'},
                        '230600': {'name': '大庆市'},
                        '230700': {'name': '伊春市'},
                        '230800': {'name': '佳木斯市'},
                        '230900': {'name': '七台河市'},
                        '231000': {'name': '牡丹江市'},
                        '231100': {'name': '黑河市'},
                        '231200': {'name': '绥化市'},
                        '232700': {'name': '大兴安岭地区'}
                    }
                },
                '320000': {  # 江苏省
                    'name': '江苏省',
                    'children': {
                        '320100': {'name': '南京市'},
                        '320200': {'name': '无锡市'},
                        '320300': {'name': '徐州市'},
                        '320400': {'name': '常州市'},
                        '320500': {'name': '苏州市'},
                        '320600': {'name': '南通市'},
                        '320700': {'name': '连云港市'},
                        '320800': {'name': '淮安市'},
                        '320900': {'name': '盐城市'},
                        '321000': {'name': '扬州市'},
                        '321100': {'name': '镇江市'},
                        '321200': {'name': '泰州市'},
                        '321300': {'name': '宿迁市'}
                    }
                },
                '330000': {  # 浙江省
                    'name': '浙江省',
                    'children': {
                        '330100': {'name': '杭州市'},
                        '330200': {'name': '宁波市'},
                        '330300': {'name': '温州市'},
                        '330400': {'name': '嘉兴市'},
                        '330500': {'name': '湖州市'},
                        '330600': {'name': '绍兴市'},
                        '330700': {'name': '金华市'},
                        '330800': {'name': '衢州市'},
                        '330900': {'name': '舟山市'},
                        '331000': {'name': '台州市'},
                        '331100': {'name': '丽水市'}
                    }
                },
                '340000': {  # 安徽省
                    'name': '安徽省',
                    'children': {
                        '340100': {'name': '合肥市'},
                        '340200': {'name': '芜湖市'},
                        '340300': {'name': '蚌埠市'},
                        '340400': {'name': '淮南市'},
                        '340500': {'name': '马鞍山市'},
                        '340600': {'name': '淮北市'},
                        '340700': {'name': '铜陵市'},
                        '340800': {'name': '安庆市'},
                        '341000': {'name': '黄山市'},
                        '341100': {'name': '滁州市'},
                        '341200': {'name': '阜阳市'},
                        '341300': {'name': '宿州市'},
                        '341400': {'name': '六安市'},
                        '341500': {'name': '亳州市'},
                        '341600': {'name': '池州市'},
                        '341700': {'name': '宣城市'}
                    }
                },
                '350000': {  # 福建省
                    'name': '福建省',
                    'children': {
                        '350100': {'name': '福州市'},
                        '350200': {'name': '厦门市'},
                        '350300': {'name': '莆田市'},
                        '350400': {'name': '三明市'},
                        '350500': {'name': '泉州市'},
                        '350600': {'name': '漳州市'},
                        '350700': {'name': '南平市'},
                        '350800': {'name': '龙岩市'},
                        '350900': {'name': '宁德市'}
                    }
                },
                '360000': {  # 江西省
                    'name': '江西省',
                    'children': {
                        '360100': {'name': '南昌市'},
                        '360200': {'name': '景德镇市'},
                        '360300': {'name': '萍乡市'},
                        '360400': {'name': '九江市'},
                        '360500': {'name': '新余市'},
                        '360600': {'name': '鹰潭市'},
                        '360700': {'name': '赣州市'},
                        '360800': {'name': '吉安市'},
                        '360900': {'name': '宜春市'},
                        '361000': {'name': '抚州市'},
                        '361100': {'name': '上饶市'}
                    }
                },
                '370000': {  # 山东省
                    'name': '山东省',
                    'children': {
                        '370100': {'name': '济南市'},
                        '370200': {'name': '青岛市'},
                        '370300': {'name': '淄博市'},
                        '370400': {'name': '枣庄市'},
                        '370500': {'name': '东营市'},
                        '370600': {'name': '烟台市'},
                        '370700': {'name': '潍坊市'},
                        '370800': {'name': '济宁市'},
                        '370900': {'name': '泰安市'},
                        '371000': {'name': '威海市'},
                        '371100': {'name': '日照市'},
                        '371200': {'name': '临沂市'},
                        '371300': {'name': '德州市'},
                        '371400': {'name': '聊城市'},
                        '371500': {'name': '滨州市'},
                        '371600': {'name': '菏泽市'}
                    }
                },
                '410000': {  # 河南省
                    'name': '河南省',
                    'children': {
                        '410100': {'name': '郑州市'},
                        '410200': {'name': '开封市'},
                        '410300': {'name': '洛阳市'},
                        '410400': {'name': '平顶山市'},
                        '410500': {'name': '安阳市'},
                        '410600': {'name': '鹤壁市'},
                        '410700': {'name': '新乡市'},
                        '410800': {'name': '焦作市'},
                        '410900': {'name': '濮阳市'},
                        '411000': {'name': '许昌市'},
                        '411100': {'name': '漯河市'},
                        '411200': {'name': '三门峡市'},
                        '411300': {'name': '南阳市'},
                        '411400': {'name': '商丘市'},
                        '411500': {'name': '信阳市'},
                        '411600': {'name': '周口市'},
                        '411700': {'name': '驻马店市'},
                        '419001': {'name': '济源市'}
                    }
                },
                '420000': {  # 湖北省
                    'name': '湖北省',
                    'children': {
                        '420100': {'name': '武汉市'},
                        '420200': {'name': '黄石市'},
                        '420300': {'name': '十堰市'},
                        '420500': {'name': '宜昌市'},
                        '420600': {'name': '襄阳市'},
                        '420700': {'name': '鄂州市'},
                        '420800': {'name': '荆门市'},
                        '420900': {'name': '孝感市'},
                        '421000': {'name': '荆州市'},
                        '421100': {'name': '黄冈市'},
                        '421200': {'name': '咸宁市'},
                        '421300': {'name': '随州市'},
                        '422800': {'name': '恩施土家族苗族自治州'},
                        '429004': {'name': '仙桃市'},
                        '429005': {'name': '潜江市'},
                        '429006': {'name': '天门市'},
                        '429021': {'name': '神农架林区'}
                    }
                },
                '430000': {  # 湖南省
                    'name': '湖南省',
                    'children': {
                        '430100': {'name': '长沙市'},
                        '430200': {'name': '株洲市'},
                        '430300': {'name': '湘潭市'},
                        '430400': {'name': '衡阳市'},
                        '430500': {'name': '邵阳市'},
                        '430600': {'name': '岳阳市'},
                        '430700': {'name': '常德市'},
                        '430800': {'name': '张家界市'},
                        '430900': {'name': '益阳市'},
                        '431000': {'name': '郴州市'},
                        '431100': {'name': '永州市'},
                        '431200': {'name': '怀化市'},
                        '431300': {'name': '娄底市'},
                        '433100': {'name': '湘西土家族苗族自治州'}
                    }
                },
                '440000': {  # 广东省
                    'name': '广东省',
                    'children': {
                        '440100': {'name': '广州市'},
                        '440200': {'name': '韶关市'},
                        '440300': {'name': '深圳市'},
                        '440400': {'name': '珠海市'},
                        '440500': {'name': '汕头市'},
                        '440600': {'name': '佛山市'},
                        '440700': {'name': '江门市'},
                        '440800': {'name': '湛江市'},
                        '440900': {'name': '茂名市'},
                        '441200': {'name': '肇庆市'},
                        '441300': {'name': '惠州市'},
                        '441400': {'name': '梅州市'},
                        '441500': {'name': '汕尾市'},
                        '441600': {'name': '河源市'},
                        '441700': {'name': '阳江市'},
                        '441800': {'name': '清远市'},
                        '441900': {'name': '东莞市'},
                        '442000': {'name': '中山市'},
                        '445100': {'name': '潮州市'},
                        '445200': {'name': '揭阳市'},
                        '445300': {'name': '云浮市'}
                    }
                },
                '450000': {  # 广西壮族自治区
                    'name': '广西壮族自治区',
                    'children': {
                        '450100': {'name': '南宁市'},
                        '450200': {'name': '柳州市'},
                        '450300': {'name': '桂林市'},
                        '450400': {'name': '梧州市'},
                        '450500': {'name': '北海市'},
                        '450600': {'name': '防城港市'},
                        '450700': {'name': '钦州市'},
                        '450800': {'name': '贵港市'},
                        '450900': {'name': '玉林市'},
                        '451000': {'name': '百色市'},
                        '451100': {'name': '贺州市'},
                        '451200': {'name': '河池市'},
                        '451300': {'name': '来宾市'},
                        '451400': {'name': '崇左市'}
                    }
                },
                '460000': {  # 海南省
                    'name': '海南省',
                    'children': {
                        '460100': {'name': '海口市'},
                        '460200': {'name': '三亚市'},
                        '460300': {'name': '三沙市'},
                        '460400': {'name': '儋州市'},
                        '460500': {'name': '五指山市'},
                        '460600': {'name': '琼海市'},
                        '460700': {'name': '文昌市'},
                        '460800': {'name': '万宁市'},
                        '460900': {'name': '东方市'},
                        '469001': {'name': '定安县'},
                        '469002': {'name': '屯昌县'},
                        '469003': {'name': '澄迈县'},
                        '469004': {'name': '临高县'},
                        '469005': {'name': '白沙黎族自治县'},
                        '469006': {'name': '昌江黎族自治县'},
                        '469007': {'name': '乐东黎族自治县'},
                        '469008': {'name': '陵水黎族自治县'},
                        '469009': {'name': '保亭黎族苗族自治县'},
                        '469010': {'name': '琼中黎族苗族自治县'},
                        '469021': {'name': '洋浦经济开发区'}
                    }
                },
                '510000': {  # 四川省
                    'name': '四川省',
                    'children': {
                        '510100': {'name': '成都市'},
                        '510300': {'name': '自贡市'},
                        '510400': {'name': '攀枝花市'},
                        '510500': {'name': '泸州市'},
                        '510600': {'name': '德阳市'},
                        '510700': {'name': '绵阳市'},
                        '510800': {'name': '广元市'},
                        '510900': {'name': '遂宁市'},
                        '511000': {'name': '内江市'},
                        '511100': {'name': '乐山市'},
                        '511300': {'name': '南充市'},
                        '511400': {'name': '眉山市'},
                        '511500': {'name': '宜宾市'},
                        '511600': {'name': '广安市'},
                        '511700': {'name': '达州市'},
                        '511800': {'name': '雅安市'},
                        '511900': {'name': '巴中市'},
                        '512000': {'name': '资阳市'},
                        '513200': {'name': '阿坝藏族羌族自治州'},
                        '513300': {'name': '甘孜藏族自治州'},
                        '513400': {'name': '凉山彝族自治州'}
                    }
                },
                '520000': {  # 贵州省
                    'name': '贵州省',
                    'children': {
                        '520100': {'name': '贵阳市'},
                        '520200': {'name': '六盘水市'},
                        '520300': {'name': '遵义市'},
                        '520400': {'name': '安顺市'},
                        '520500': {'name': '毕节市'},
                        '520600': {'name': '铜仁市'},
                        '522300': {'name': '黔西南布依族苗族自治州'},
                        '522600': {'name': '黔东南苗族侗族自治州'},
                        '522700': {'name': '黔南布依族苗族自治州'}
                    }
                },
                '530000': {  # 云南省
                    'name': '云南省',
                    'children': {
                        '530100': {'name': '昆明市'},
                        '530300': {'name': '曲靖市'},
                        '530400': {'name': '玉溪市'},
                        '530500': {'name': '保山市'},
                        '530600': {'name': '昭通市'},
                        '530700': {'name': '丽江市'},
                        '530800': {'name': '普洱市'},
                        '530900': {'name': '临沧市'},
                        '532300': {'name': '楚雄彝族自治州'},
                        '532500': {'name': '红河哈尼族彝族自治州'},
                        '532600': {'name': '文山壮族苗族自治州'},
                        '532800': {'name': '西双版纳傣族自治州'},
                        '532900': {'name': '大理白族自治州'},
                        '533100': {'name': '德宏傣族景颇族自治州'},
                        '533300': {'name': '怒江傈僳族自治州'},
                        '533400': {'name': '迪庆藏族自治州'}
                    }
                },
                '540000': {  # 西藏自治区
                    'name': '西藏自治区',
                    'children': {
                        '540100': {'name': '拉萨市'},
                        '540200': {'name': '日喀则市'},
                        '540300': {'name': '昌都市'},
                        '540400': {'name': '林芝市'},
                        '540500': {'name': '山南市'},
                        '542400': {'name': '那曲市'},
                        '542500': {'name': '阿里地区'}
                    }
                },
                '610000': {  # 陕西省
                    'name': '陕西省',
                    'children': {
                        '610100': {'name': '西安市'},
                        '610200': {'name': '铜川市'},
                        '610300': {'name': '宝鸡市'},
                        '610400': {'name': '咸阳市'},
                        '610500': {'name': '渭南市'},
                        '610600': {'name': '延安市'},
                        '610700': {'name': '汉中市'},
                        '610800': {'name': '榆林市'},
                        '610900': {'name': '安康市'},
                        '611000': {'name': '商洛市'}
                    }
                },
                '620000': {  # 甘肃省
                    'name': '甘肃省',
                    'children': {
                        '620100': {'name': '兰州市'},
                        '620200': {'name': '嘉峪关市'},
                        '620300': {'name': '金昌市'},
                        '620400': {'name': '白银市'},
                        '620500': {'name': '天水市'},
                        '620600': {'name': '武威市'},
                        '620700': {'name': '张掖市'},
                        '620800': {'name': '平凉市'},
                        '620900': {'name': '酒泉市'},
                        '621000': {'name': '庆阳市'},
                        '621100': {'name': '定西市'},
                        '621200': {'name': '陇南市'},
                        '622900': {'name': '临夏回族自治州'},
                        '623000': {'name': '甘南藏族自治州'}
                    }
                },
                '630000': {  # 青海省
                    'name': '青海省',
                    'children': {
                        '630100': {'name': '西宁市'},
                        '630200': {'name': '海东市'},
                        '632200': {'name': '海北藏族自治州'},
                        '632300': {'name': '黄南藏族自治州'},
                        '632500': {'name': '海南藏族自治州'},
                        '632600': {'name': '果洛藏族自治州'},
                        '632700': {'name': '玉树藏族自治州'},
                        '632800': {'name': '海西蒙古族藏族自治州'}
                    }
                },
                '640000': {  # 宁夏回族自治区
                    'name': '宁夏回族自治区',
                    'children': {
                        '640100': {'name': '银川市'},
                        '640200': {'name': '石嘴山市'},
                        '640300': {'name': '吴忠市'},
                        '640400': {'name': '固原市'},
                        '640500': {'name': '中卫市'}
                    }
                },
                '650000': {  # 新疆维吾尔自治区
                    'name': '新疆维吾尔自治区',
                    'children': {
                        '650100': {'name': '乌鲁木齐市'},
                        '650200': {'name': '克拉玛依市'},
                        '650400': {'name': '吐鲁番市'},
                        '650500': {'name': '哈密市'},
                        '652200': {'name': '昌吉回族自治州'},
                        '652700': {'name': '博尔塔拉蒙古自治州'},
                        '652800': {'name': '巴音郭楞蒙古自治州'},
                        '652900': {'name': '阿克苏地区'},
                        '653000': {'name': '克孜勒苏柯尔克孜自治州'},
                        '653100': {'name': '喀什地区'},
                        '653200': {'name': '和田地区'},
                        '654200': {'name': '伊犁哈萨克自治州'},
                        '654300': {'name': '塔城地区'},
                        '654400': {'name': '阿勒泰地区'}
                    }
                }
            }
        }
    }
    
    # 递归创建行政区划数据
    def create_region_recursive(data, parent_code=None, level='country'):
        """递归创建行政区划"""
        
        region_objects = {}
        
        for code, region_data in data.items():
            region = Region(
                name=region_data['name'],
                code=code,
                level=level,
                sort_order=int(code[-2:]) if code[-2:].isdigit() else 0
            )
            
            if parent_code:
                region.parent_id = parent_code
            
            db.session.add(region)
            db.session.flush()  # 获取ID
            
            region_objects[code] = region
            print(f"创建地区: {region.name} ({code})")
            
            # 如果有子级，递归创建
            if 'children' in region_data:
                children_data = {}
                for child_code, child_data in region_data['children'].items():
                    children_data[child_code] = child_data
                
                create_region_recursive(children_data, region.id, 'province' if level == 'country' else 'city')
        
        return region_objects
    
    try:
        # 创建国家级数据
        create_region_recursive(china_regions['country']['children'], level='province')
        
        print(f"成功创建 {Region.query.count()} 个行政区划记录")
        
    except Exception as e:
        print(f"创建行政区划数据时发生错误: {str(e)}")
        db.session.rollback()
        raise

def init_system_settings():
    """初始化系统设置"""
    
    print("正在初始化系统设置...")
    
    # 检查是否已有设置
    if Settings.query.count() > 0:
        print("系统设置已存在，跳过初始化")
        return
    
    # 默认系统设置
    default_settings = [
        {
            'key': 'crawler.max_concurrent',
            'value': '5',
            'description': '爬虫最大并发数',
            'data_type': 'integer',
            'category': 'crawler'
        },
        {
            'key': 'crawler.request_timeout',
            'value': '30',
            'description': '爬虫请求超时时间（秒）',
            'data_type': 'integer',
            'category': 'crawler'
        },
        {
            'key': 'crawler.delay_range',
            'value': '1,5',
            'description': '爬虫请求延迟范围（秒）',
            'data_type': 'string',
            'category': 'crawler'
        },
        {
            'key': 'scheduler.tender_scan_interval',
            'value': '6',
            'description': '招投标扫描间隔（小时）',
            'data_type': 'integer',
            'category': 'scheduler'
        },
        {
            'key': 'scheduler.hospital_scan_interval',
            'value': '24',
            'description': '医院扫描间隔（小时）',
            'data_type': 'integer',
            'category': 'scheduler'
        },
        {
            'key': 'scheduler.daily_report_time',
            'value': '02:00',
            'description': '每日报告时间',
            'data_type': 'string',
            'category': 'scheduler'
        },
        {
            'key': 'export.max_records',
            'value': '50000',
            'description': '最大导出记录数',
            'data_type': 'integer',
            'category': 'export'
        },
        {
            'key': 'search.duckduckgo_enabled',
            'value': 'true',
            'description': '是否启用DuckDuckGo搜索',
            'data_type': 'boolean',
            'category': 'search'
        },
        {
            'key': 'robots.txt_check_enabled',
            'value': 'true',
            'description': '是否检查robots.txt',
            'data_type': 'boolean',
            'category': 'crawler'
        },
        {
            'key': 'system.maintenance_mode',
            'value': 'false',
            'description': '系统维护模式',
            'data_type': 'boolean',
            'category': 'system'
        }
    ]
    
    for setting_data in default_settings:
        setting = Settings(**setting_data)
        db.session.add(setting)
    
    print(f"成功创建 {len(default_settings)} 个系统设置记录")

if __name__ == '__main__':
    # 直接运行时的初始化
    from app import create_app, db
    
    app = create_app()
    
    with app.app_context():
        init_basic_data()